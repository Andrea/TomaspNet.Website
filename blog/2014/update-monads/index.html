<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
  <meta charset="utf-8">
  <title>Stateful computations in F# with update monads</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="This article is a contribution to the F# Advent Calendar that is organized every year by the Japanese F# community - and so the article is inspired by the Japanese culture. We look at a list of Japanese artists in Freebase and try to recreate one piece using fractals and FunScript!">
  <meta name="author" content="Tomas Petricek">

  <!-- Reference Foundation -->
  <link rel="stylesheet" href="http://tomasp.net/css/foundation.css">
  <script src="js/vendor/custom.modernizr.js"></script>

  <link rel="alternate" type="application/rss+xml" href="http://tomasp.net/rss.xml" title="RSS feed for Tomas Petricek's blog">
  <link rel="author" href="https://plus.google.com/109855146654605967051" />
    
  <!-- Reference custom CSS and tooltips -->
  <link type="text/css" rel="stylesheet" href="http://tomasp.net/custom/style.css" />
  <script type="text/javascript" src="http://tomasp.net/custom/tooltips.js"></script>
  <link type="text/css" rel="stylesheet" href="http://tomasp.net/custom/tooltips.css" />
</head>
<body>

   <header id="top-header">
    <div class="row">
      <div class="twelve columns">
        <h1><a href="http://tomasp.net/">Tomas Petricek's blog</a></h1>
        <p>Writing about practical F# coding and programming language research</p>
      </div>
    </div>
  </header>

  <header class="top-bar-header">
    <div class="contain-to-grid sticky">
    <nav class="top-bar">

    <ul class="title-area">
      <li class="name"><h1><a href="#"></a></h1></li>
      <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
    </ul>
    <section class="top-bar-section">
      <ul class="right">
        <li><a href="http://tomasp.net/blog/index.html">Blog</a></li>
        <li><a href="http://functional-programming.net">Trainings</a></li>
        <li><a href="http://functional-programming.net">Books</a></li>
        <li><a href="http://lanyrd.com/profile/tomasp">Talks</a></li>
        <li><a href="http://tomasp.net/academic">Research & Teaching</a></li>
      </ul>
    </section>

    </nav></div>
  </header>
  
  
<div class="row">
	<div class="large-8 columns main-content">
    <content>
      

<h1>Stateful computations in F# with update monads</h1>

<p>Most discussions about monads start by looking at the well-known standard monads
for handling state from Haskell. The <em>reader</em> monad gives us a way to propagate some
read-only state, the <em>writer</em> monad makes it possible to (imperatively) produce values
such as logs and the <em>state</em> monad encapsulates state that can be read and changed.</p>

<p>These are no doubt useful in Haskell, but I never found them as important for F#.
The first reason is that F# supports state and mutation and often it is just easier
to use a mutable state. The second reason is that you have to implement three 
different computation builders for them. This does not fit very well with the F# style
where you need to name the computation explicitly, e.g. by writing <code>async { ... }</code>
(See also my <a href="http://localhost:8080/blog/2013/computation-zoo-padl">recent blog about the F# Computation Zoo paper</a>).</p>

<p>When visiting the Tallinn university in December (thanks to James Chapman, Juhan Ernits 
&amp; Tarmo Uustalu for hosting me!), I discovered the work on <em>update monads</em> by Danel Ahman 
and Tarmo Uustalu, which elegantly unifies <em>reader</em>, <em>writer</em> and <em>state</em> monads using
a single abstraction.</p>

<p>In this article, I implement the idea of <em>update monads</em> in F#. Update monads are 
parameterized by <em>acts</em> that capture the operations that can be done on the state.
This means that we can define just a single computation expression <code>update { ... }</code> 
and use it for writing computations of all three aforementioned kinds.</p>

<h2>Introducing update monads</h2>

<p>Before looking at the definition of update monads, it is useful to review the three
monads that we want to unify. The <a href="http://www.paper.net">update monads paper</a> has more details and you 
can also find other tutorials that implement these in F# - here, we'll only look at the
type definitions:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Given a readonly state, produces a value</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">Reader</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">TState</span>, <span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&#39;</span><span class="i">TState</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">T</span>
<span class="c">/// Produces a value together with additional state</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Writer</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">TState</span>, <span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">&#39;</span><span class="i">TState</span> <span class="o">*</span> <span class="o">&#39;</span><span class="i">T</span>
<span class="c">/// Given state, produces new state &amp; a value</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">State</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">TState</span>, <span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>  <span class="o">=</span> <span class="o">&#39;</span><span class="i">TState</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">TState</span> <span class="o">*</span> <span class="o">&#39;</span><span class="i">T</span></pre>
</td>
</tr>
</table>

<p>If you look at the definitions, it looks like <em>reader</em> and <em>writer</em> are both a versions
of the <em>state</em> with some aspect missing - reader does not produce a new state and writer
does not take previous state.</p>

<p>How can we define a parameterized computation type that allows leaving one or the other
out? The idea of <em>update monads</em> is quite simple. The trick is that we'll take two different
types - one representing the <em>state</em> we can read and another representing the <em>actions</em> 
that a computation can apply to the state:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Represents an update monad - given a state, produce </span>
<span class="c">/// value and an action that can be applied to the state</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">UpdateMonad</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">TState</span>, <span class="o">&#39;</span><span class="i">TAction</span>, <span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">=</span> 
  <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">UM</span> <span class="k">of</span> (<span class="o">&#39;</span><span class="i">TState</span> <span class="k">-&gt;</span> <span class="o">&#39;</span><span class="i">TAction</span> <span class="o">*</span> <span class="o">&#39;</span><span class="i">T</span>)</pre>
</td>
</tr>
</table>

<p>To make the F# implementation a bit nicer, this is not defined as a type alias, but as a 
new type labeled with <code>UM</code> (this makes sure that the infered types will always use the
name <code>UpdateMonad</code> for the type, rather than its definition).</p>

<p>To make this work, we also need some operations on the types representing states and actions.
In particular, we need:</p>

<ul>
<li><strong>Unit action</strong> which represents that no action is applied.</li>
<li><strong>Composition on actions</strong> that allows combining multiple actions on 
the state into a single action.</li>
<li><strong>Application</strong> that takes a state and an action and applies the action
on the state, producing new state as the result.</li>
</ul>

<p>In more formal terms, the type of actions needs to be a monoid (with unit and composition).
In the paper, the two types (sets) together with the operations are called <em>act</em> and are
defined as (S, (P,∘,⊕), ↓) where ∘ is the unit, ⊕ is composition and ↓ is the application.</p>

<h2>Implementing update monads in F#</h2>

<p>To implement this idea in F#, we can use <a href="http://www.paper.net/static-member-constraints">static member constraints</a>. We will require
the user to define two types representing <code>State</code> and <code>Action</code>, respectively. The <code>Action</code>
type will need to define the three operations. An abstract definition (not valid F# code)
would look like this:</p>

<pre>
<span class="k">type</span> <span class="i">State</span>
<span class="k">type</span> <span class="i">Action</span> <span class="o">=</span>
  <span class="k">static</span> <span class="i">Unit</span>    <span class="o">:</span> <span class="i">Action</span>
  <span class="k">static</span> <span class="i">Combine</span> <span class="o">:</span> <span class="i">Action</span> <span class="o">*</span> <span class="i">Action</span> <span class="o">-&gt;</span> <span class="i">Action</span>
  <span class="k">static</span> <span class="i">Apply</span>   <span class="o">:</span> <span class="i">State</span> <span class="o">*</span> <span class="i">Action</span> <span class="o">-&gt;</span> <span class="i">State</span>
</pre>

<p>Invocation of members via static member constraints is not entirely easy (the feature is 
used mainly by library implementors for things like generic numerical code). But the idea
is that we can define inline functions (<code>unit</code>, <code>++</code> and <code>apply</code>) that invoke the 
corresponding operation on the type (specified either explicitly or via type inference).</p>

<p>If you're not familiar with F#, you can freely skip over this definition, just remember
that we now have functions <code>unit</code> and <code>apply</code> and an operator <code>++</code>:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Returns the value of &#39;Unit&#39; property on the ^S type</span>
<span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="i">unit</span><span class="o">&lt;</span> <span class="o">^</span><span class="i">S</span> <span class="k">when</span> <span class="o">^</span><span class="i">S</span> <span class="o">:</span> 
    (<span class="k">static</span> <span class="k">member</span> <span class="i">Unit</span> <span class="o">:</span> <span class="o">^</span><span class="i">S</span>)<span class="o">&gt;</span> () <span class="o">:</span> <span class="o">^</span><span class="i">S</span> <span class="o">=</span>
  (<span class="o">^</span><span class="i">S</span> <span class="o">:</span> (<span class="k">static</span> <span class="k">member</span> <span class="i">Unit</span> <span class="o">:</span> <span class="o">^</span><span class="i">S</span>) ()) 

<span class="c">/// Invokes Combine operation on a pair of ^S values</span>
<span class="k">let</span> <span class="k">inline</span> (<span class="o">++</span>)<span class="o">&lt;</span> <span class="o">^</span><span class="i">S</span> <span class="k">when</span> <span class="o">^</span><span class="i">S</span> <span class="o">:</span> 
    (<span class="k">static</span> <span class="k">member</span> <span class="i">Combine</span> <span class="o">:</span> <span class="o">^</span><span class="i">S</span> <span class="o">*</span> <span class="o">^</span><span class="i">S</span> <span class="k">-&gt;</span> <span class="o">^</span><span class="i">S</span> )<span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="i">a</span> <span onmouseout="hideTip(event, 'fs8', 8)" onmouseover="showTip(event, 'fs8', 8)" class="i">b</span> <span class="o">:</span> <span class="o">^</span><span class="i">S</span> <span class="o">=</span>
  (<span class="o">^</span><span class="i">S</span> <span class="o">:</span> (<span class="k">static</span> <span class="k">member</span> <span class="i">Combine</span> <span class="o">:</span> <span class="o">^</span><span class="i">S</span> <span class="o">*</span> <span class="o">^</span><span class="i">S</span> <span class="k">-&gt;</span> <span class="o">^</span><span class="i">S</span>) (<span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="i">b</span>)) 

<span class="c">/// Invokes Apply operation on state and action ^S * ^A</span>
<span class="k">let</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs9', 11)" onmouseover="showTip(event, 'fs9', 11)" class="i">apply</span><span class="o">&lt;</span> <span class="o">^</span><span class="i">S</span>, <span class="o">^</span><span class="i">A</span> <span class="k">when</span> <span class="o">^</span><span class="i">A</span> <span class="o">:</span> 
    (<span class="k">static</span> <span class="k">member</span> <span class="i">Apply</span> <span class="o">:</span> <span class="o">^</span><span class="i">S</span> <span class="o">*</span> <span class="o">^</span><span class="i">A</span> <span class="k">-&gt;</span> <span class="o">^</span><span class="i">S</span> )<span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs10', 12)" onmouseover="showTip(event, 'fs10', 12)" class="i">s</span> <span onmouseout="hideTip(event, 'fs11', 13)" onmouseover="showTip(event, 'fs11', 13)" class="i">a</span> <span class="o">:</span> <span class="o">^</span><span class="i">S</span> <span class="o">=</span>
  (<span class="o">^</span><span class="i">A</span> <span class="o">:</span> (<span class="k">static</span> <span class="k">member</span> <span class="i">Apply</span> <span class="o">:</span> <span class="o">^</span><span class="i">S</span> <span class="o">*</span> <span class="o">^</span><span class="i">A</span> <span class="k">-&gt;</span> <span class="o">^</span><span class="i">S</span>) (<span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="i">s</span>, <span onmouseout="hideTip(event, 'fs11', 15)" onmouseover="showTip(event, 'fs11', 15)" class="i">a</span>)) </pre>
</td>
</tr>
</table>

<p>The last thing that we need to do before we can start playing with some
update monads is to implement the monadic operators. In F#, this is done by
defining a <em>computation builder</em> - a type that has <code>Bind</code> and <code>Return</code> 
operations (as well as some others that we'll see later). The compiler then
automatically translates a block <code>update { .. }</code> using operations <code>update.Return</code>
and <code>update.Bind</code>.</p>

<p>The computation builder is a normal class with members. Because we are using 
static member constraints and inline functions, we need to mark the members
as <code>inline</code> too:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs12', 16)" onmouseover="showTip(event, 'fs12', 16)" class="i">UpdateBuilder</span>() <span class="o">=</span> 
  <span class="c">/// Returns the specified value, together</span>
  <span class="c">/// with empty action obtained using &#39;unit&#39;</span>
  <span class="k">member</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs13', 17)" onmouseover="showTip(event, 'fs13', 17)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 18)" onmouseover="showTip(event, 'fs14', 18)" class="i">Return</span>(<span onmouseout="hideTip(event, 'fs15', 19)" onmouseover="showTip(event, 'fs15', 19)" class="i">v</span>) <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 20)" onmouseover="showTip(event, 'fs4', 20)" class="i">UpdateMonad</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">S</span>, <span class="o">&#39;</span><span class="i">A</span>, <span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs5', 21)" onmouseover="showTip(event, 'fs5', 21)" class="i">UM</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs10', 22)" onmouseover="showTip(event, 'fs10', 22)" class="i">s</span> <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs6', 23)" onmouseover="showTip(event, 'fs6', 23)" class="i">unit</span>(),<span onmouseout="hideTip(event, 'fs15', 24)" onmouseover="showTip(event, 'fs15', 24)" class="i">v</span>))

  <span class="c">/// Compose two update monad computations</span>
  <span class="k">member</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs13', 25)" onmouseover="showTip(event, 'fs13', 25)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 26)" onmouseover="showTip(event, 'fs16', 26)" class="i">Bind</span>(<span onmouseout="hideTip(event, 'fs5', 27)" onmouseover="showTip(event, 'fs5', 27)" class="i">UM</span> <span onmouseout="hideTip(event, 'fs17', 28)" onmouseover="showTip(event, 'fs17', 28)" class="i">u1</span>, <span onmouseout="hideTip(event, 'fs18', 29)" onmouseover="showTip(event, 'fs18', 29)" class="i">f</span><span class="o">:</span><span class="o">&#39;</span><span class="i">T</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 30)" onmouseover="showTip(event, 'fs4', 30)" class="i">UpdateMonad</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">S</span>, <span class="o">&#39;</span><span class="i">P</span>, <span class="o">&#39;</span><span class="i">R</span><span class="o">&gt;</span>) <span class="o">=</span>  
    <span onmouseout="hideTip(event, 'fs5', 31)" onmouseover="showTip(event, 'fs5', 31)" class="i">UM</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs10', 32)" onmouseover="showTip(event, 'fs10', 32)" class="i">s</span> <span class="k">-&gt;</span> 
      <span class="c">// Run the first computation to get first action</span>
      <span class="c">// &#39;a1&#39;, then run &#39;f&#39; to get second computation</span>
      <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs19', 33)" onmouseover="showTip(event, 'fs19', 33)" class="i">a1</span>, <span onmouseout="hideTip(event, 'fs20', 34)" onmouseover="showTip(event, 'fs20', 34)" class="i">x</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs17', 35)" onmouseover="showTip(event, 'fs17', 35)" class="i">u1</span> <span onmouseout="hideTip(event, 'fs10', 36)" onmouseover="showTip(event, 'fs10', 36)" class="i">s</span>
      <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs5', 37)" onmouseover="showTip(event, 'fs5', 37)" class="i">UM</span> <span onmouseout="hideTip(event, 'fs21', 38)" onmouseover="showTip(event, 'fs21', 38)" class="i">u2</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 39)" onmouseover="showTip(event, 'fs18', 39)" class="i">f</span> <span onmouseout="hideTip(event, 'fs20', 40)" onmouseover="showTip(event, 'fs20', 40)" class="i">x</span>
      <span class="c">// Apply &#39;a1&#39; to original state &amp; run second computation</span>
      <span class="c">// then return result with combined state actions</span>
      <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs22', 41)" onmouseover="showTip(event, 'fs22', 41)" class="i">a2</span>, <span onmouseout="hideTip(event, 'fs23', 42)" onmouseover="showTip(event, 'fs23', 42)" class="i">y</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 43)" onmouseover="showTip(event, 'fs21', 43)" class="i">u2</span> (<span onmouseout="hideTip(event, 'fs9', 44)" onmouseover="showTip(event, 'fs9', 44)" class="i">apply</span> <span onmouseout="hideTip(event, 'fs10', 45)" onmouseover="showTip(event, 'fs10', 45)" class="i">s</span> <span onmouseout="hideTip(event, 'fs19', 46)" onmouseover="showTip(event, 'fs19', 46)" class="i">a1</span>)
      (<span onmouseout="hideTip(event, 'fs19', 47)" onmouseover="showTip(event, 'fs19', 47)" class="i">a1</span> <span class="o">++</span> <span onmouseout="hideTip(event, 'fs22', 48)" onmouseover="showTip(event, 'fs22', 48)" class="i">a2</span>, <span onmouseout="hideTip(event, 'fs23', 49)" onmouseover="showTip(event, 'fs23', 49)" class="i">y</span>))

<span class="c">/// Instance of the computation builder</span>
<span class="c">/// that defines the update { .. } block</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs24', 50)" onmouseover="showTip(event, 'fs24', 50)" class="i">update</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 51)" onmouseover="showTip(event, 'fs12', 51)" class="i">UpdateBuilder</span>()</pre>
</td>
</tr>
</table>

<p>The implementation of the <code>Return</code> operation is quite simple - we return
the specified value and call <code>unit()</code> to get the unit of the monoid of 
actions - as a result, we get a computation that returns the value without
performing any action on the state.</p>

<p>The <code>Bind</code> member is more interesting - it runs the first computation which
returns a value <code>x</code> and an action <code>a1</code>. The second computation needs to be
run in an updated state and so we use <code>apply s a1</code> to calculate a new state
that reflects the action. After running the second computation, we get the
final resulting value <code>y</code> and a second action <code>a2</code>. The result of the 
computation combines the two actions using <code>a1 ++ a2</code>.</p>

<p>How does this actually work? Let's start by looking at reader and writer
monads (which are special cases of the update monad.</p>

<h2>Implementing the reader monad</h2>

<p>The reader monad keeps some state, but it does not give us any way of modifying it.
In terms of update monads, this means that there is some state, but the monoid of
actions is trivial - in principle, we can just use <code>unit</code> as the type of actions.
You can see that when looking at the type too - the type of reader monad is
<code>'TState -&gt; 'T</code> and we need to turn it into <code>'TState -&gt; unit * 'T</code>.</p>

<h3>Reader state and action</h3>

<p>In practice, we still need to define a type for actions, so that we can provide the
required static members. We use a single-case discriminated union with just one value
<code>NoAction</code>:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// The state of the reader is &#39;int&#39;</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs25', 52)" onmouseover="showTip(event, 'fs25', 52)" class="i">ReaderState</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs26', 53)" onmouseover="showTip(event, 'fs26', 53)" class="i">int</span>
<span class="c">/// Trivial monoid of actions </span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs27', 54)" onmouseover="showTip(event, 'fs27', 54)" class="i">ReaderAction</span> <span class="o">=</span> 
  | <span onmouseout="hideTip(event, 'fs28', 55)" onmouseover="showTip(event, 'fs28', 55)" class="i">NoAction</span>
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs29', 56)" onmouseover="showTip(event, 'fs29', 56)" class="i">Unit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs28', 57)" onmouseover="showTip(event, 'fs28', 57)" class="i">NoAction</span>
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs30', 58)" onmouseover="showTip(event, 'fs30', 58)" class="i">Combine</span>(<span onmouseout="hideTip(event, 'fs28', 59)" onmouseover="showTip(event, 'fs28', 59)" class="i">NoAction</span>, <span onmouseout="hideTip(event, 'fs28', 60)" onmouseover="showTip(event, 'fs28', 60)" class="i">NoAction</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs28', 61)" onmouseover="showTip(event, 'fs28', 61)" class="i">NoAction</span>
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs31', 62)" onmouseover="showTip(event, 'fs31', 62)" class="i">Apply</span>(<span onmouseout="hideTip(event, 'fs32', 63)" onmouseover="showTip(event, 'fs32', 63)" class="i">s</span>, <span onmouseout="hideTip(event, 'fs28', 64)" onmouseover="showTip(event, 'fs28', 64)" class="i">NoAction</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs32', 65)" onmouseover="showTip(event, 'fs32', 65)" class="i">s</span></pre>
</td>
</tr>
</table>

<p>None of the operations on the <code>ReaderAction</code> type does anything interesting.
Both unit and combine simply returns the only possible value and the apply
operation returns the state without a change.</p>

<h3>Reader monad primitives</h3>

<p>Next, we need a primitive that allows us to read the state and a run operation
that executes a computation implemented using the reader monad (given the
value of the read-only state). The operations look as follows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Read the current state (int) and return it as &#39;int&#39;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 66)" onmouseover="showTip(event, 'fs33', 66)" class="i">read</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 67)" onmouseover="showTip(event, 'fs5', 67)" class="i">UM</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs34', 68)" onmouseover="showTip(event, 'fs34', 68)" class="i">s</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs25', 69)" onmouseover="showTip(event, 'fs25', 69)" class="i">ReaderState</span>) <span class="k">-&gt;</span> 
  (<span onmouseout="hideTip(event, 'fs28', 70)" onmouseover="showTip(event, 'fs28', 70)" class="i">NoAction</span>, <span onmouseout="hideTip(event, 'fs34', 71)" onmouseover="showTip(event, 'fs34', 71)" class="i">s</span>))
<span class="c">/// Run computation and return the result </span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 72)" onmouseover="showTip(event, 'fs35', 72)" class="i">readRun</span> (<span onmouseout="hideTip(event, 'fs34', 73)" onmouseover="showTip(event, 'fs34', 73)" class="i">s</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs25', 74)" onmouseover="showTip(event, 'fs25', 74)" class="i">ReaderState</span>) (<span onmouseout="hideTip(event, 'fs5', 75)" onmouseover="showTip(event, 'fs5', 75)" class="i">UM</span> <span onmouseout="hideTip(event, 'fs36', 76)" onmouseover="showTip(event, 'fs36', 76)" class="i">f</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs36', 77)" onmouseover="showTip(event, 'fs36', 77)" class="i">f</span> <span onmouseout="hideTip(event, 'fs34', 78)" onmouseover="showTip(event, 'fs34', 78)" class="i">s</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs37', 79)" onmouseover="showTip(event, 'fs37', 79)" class="i">snd</span></pre>
</td>
</tr>
</table>

<p>When you look at the type of computations (hover the mouse pointer over the
<code>read</code> identifier), you can see a parameterized update monad type. The <code>read</code>
primitive has a type <code>UpdateMonad&lt;ReaderState,ReaderAction,ReaderState&gt;</code>. This
means that we have an update monad that uses <code>ReaderState</code> and <code>ReaderAction</code> as
the <em>act</em> (specifying the computation details) and, when executed, produces a 
value of <code>ReaderState</code>.</p>

<h3>Sample reader computations</h3>

<p>Now we can use the <code>update { .. }</code> block together with the <code>read</code> primitive
to write computations that can read an immutable state. The following 
basic example reads the state and adds one (in <code>demo1</code>), and then adds 
1 again in <code>demo2</code>:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">/// Returns state + 1</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs38', 80)" onmouseover="showTip(event, 'fs38', 80)" class="i">demo1</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 81)" onmouseover="showTip(event, 'fs24', 81)" class="i">update</span> { 
  <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs39', 82)" onmouseover="showTip(event, 'fs39', 82)" class="i">v</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs33', 83)" onmouseover="showTip(event, 'fs33', 83)" class="i">read</span>
  <span class="k">return</span> <span onmouseout="hideTip(event, 'fs39', 84)" onmouseover="showTip(event, 'fs39', 84)" class="i">v</span> <span class="o">+</span> <span class="n">1</span> }
<span class="c">/// Returns the result of demo1 + 1</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs40', 85)" onmouseover="showTip(event, 'fs40', 85)" class="i">demo2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 86)" onmouseover="showTip(event, 'fs24', 86)" class="i">update</span> { 
  <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs39', 87)" onmouseover="showTip(event, 'fs39', 87)" class="i">v</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs38', 88)" onmouseover="showTip(event, 'fs38', 88)" class="i">demo1</span>
  <span class="k">return</span> <span onmouseout="hideTip(event, 'fs39', 89)" onmouseover="showTip(event, 'fs39', 89)" class="i">v</span> <span class="o">+</span> <span class="n">1</span> }

<span class="c">// Run it with state 40 </span>
<span onmouseout="hideTip(event, 'fs40', 90)" onmouseover="showTip(event, 'fs40', 90)" class="i">demo2</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs35', 91)" onmouseover="showTip(event, 'fs35', 91)" class="i">readRun</span> <span class="n">40</span></pre>
</td>
</tr>
</table>

<p>If you run the code, you'll see that the result is 42. The interesting thing
about this approach is that we only had to define two types. The <code>update { .. }</code>
computation works for all update monads and so we get the computation builder
"for free". However, thanks to the parameterization, the computation really represents
an immutable state - there is no way to mutate it.</p>

<h2>Implementing the writer monad</h2>

<p>Similarly to the reader monad, the writer monad is just a simple special case of the
update monad. This time, the <em>state</em> is trivial and all the interesting things are
happening in the <em>actions</em>. The type of the usual writer monad is <code>'TState * 'T</code> and
so if we want to make this a special case of update monad, we can define the type
as <code>unit -&gt; 'TState * 'T</code>.</p>

<h3>Writer state and action</h3>

<p>The state needs to be a monoid (with unit and composition) so that we can compose
the states of multiple sub-computations. The following example uses a list as a
concrete example. We define a (writer) monad that keeps a list of <code>'TLog</code> values
and returns that as the result:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs41', 92)" onmouseover="showTip(event, 'fs41', 92)" class="i">WriterState</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs42', 93)" onmouseover="showTip(event, 'fs42', 93)" class="i">NoState</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs43', 94)" onmouseover="showTip(event, 'fs43', 94)" class="i">WriterAction</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">TLog</span><span class="o">&gt;</span> <span class="o">=</span> 
  | <span onmouseout="hideTip(event, 'fs44', 95)" onmouseover="showTip(event, 'fs44', 95)" class="i">Log</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs45', 96)" onmouseover="showTip(event, 'fs45', 96)" class="i">list</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">TLog</span><span class="o">&gt;</span>
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs46', 97)" onmouseover="showTip(event, 'fs46', 97)" class="i">Unit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs44', 98)" onmouseover="showTip(event, 'fs44', 98)" class="i">Log</span> []
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs47', 99)" onmouseover="showTip(event, 'fs47', 99)" class="i">Combine</span>(<span onmouseout="hideTip(event, 'fs44', 100)" onmouseover="showTip(event, 'fs44', 100)" class="i">Log</span> <span onmouseout="hideTip(event, 'fs48', 101)" onmouseover="showTip(event, 'fs48', 101)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs44', 102)" onmouseover="showTip(event, 'fs44', 102)" class="i">Log</span> <span onmouseout="hideTip(event, 'fs49', 103)" onmouseover="showTip(event, 'fs49', 103)" class="i">b</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs44', 104)" onmouseover="showTip(event, 'fs44', 104)" class="i">Log</span>(<span onmouseout="hideTip(event, 'fs50', 105)" onmouseover="showTip(event, 'fs50', 105)" class="i">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 106)" onmouseover="showTip(event, 'fs51', 106)" class="i">append</span> <span onmouseout="hideTip(event, 'fs48', 107)" onmouseover="showTip(event, 'fs48', 107)" class="i">a</span> <span onmouseout="hideTip(event, 'fs49', 108)" onmouseover="showTip(event, 'fs49', 108)" class="i">b</span>)
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs52', 109)" onmouseover="showTip(event, 'fs52', 109)" class="i">Apply</span>(<span onmouseout="hideTip(event, 'fs42', 110)" onmouseover="showTip(event, 'fs42', 110)" class="i">NoState</span>, _) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs42', 111)" onmouseover="showTip(event, 'fs42', 111)" class="i">NoState</span></pre>
</td>
</tr>
</table>

<h3>Writer monad primitives</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs53', 112)" onmouseover="showTip(event, 'fs53', 112)" class="i">write</span> <span onmouseout="hideTip(event, 'fs54', 113)" onmouseover="showTip(event, 'fs54', 113)" class="i">v</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 114)" onmouseover="showTip(event, 'fs5', 114)" class="i">UM</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs55', 115)" onmouseover="showTip(event, 'fs55', 115)" class="i">s</span> <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs44', 116)" onmouseover="showTip(event, 'fs44', 116)" class="i">Log</span> [<span onmouseout="hideTip(event, 'fs54', 117)" onmouseover="showTip(event, 'fs54', 117)" class="i">v</span>], ()))
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs56', 118)" onmouseover="showTip(event, 'fs56', 118)" class="i">writeRun</span> (<span onmouseout="hideTip(event, 'fs5', 119)" onmouseover="showTip(event, 'fs5', 119)" class="i">UM</span> <span onmouseout="hideTip(event, 'fs57', 120)" onmouseover="showTip(event, 'fs57', 120)" class="i">f</span>) <span class="o">=</span> <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs44', 121)" onmouseover="showTip(event, 'fs44', 121)" class="i">Log</span> <span onmouseout="hideTip(event, 'fs58', 122)" onmouseover="showTip(event, 'fs58', 122)" class="i">l</span>, <span onmouseout="hideTip(event, 'fs59', 123)" onmouseover="showTip(event, 'fs59', 123)" class="i">v</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs57', 124)" onmouseover="showTip(event, 'fs57', 124)" class="i">f</span> <span onmouseout="hideTip(event, 'fs42', 125)" onmouseover="showTip(event, 'fs42', 125)" class="i">NoState</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs58', 126)" onmouseover="showTip(event, 'fs58', 126)" class="i">l</span>, <span onmouseout="hideTip(event, 'fs59', 127)" onmouseover="showTip(event, 'fs59', 127)" class="i">v</span></pre>
</td>
</tr>
</table>

<h3>Sample writer computations</h3>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs60', 128)" onmouseover="showTip(event, 'fs60', 128)" class="i">demo3</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 129)" onmouseover="showTip(event, 'fs24', 129)" class="i">update</span> {
  <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs53', 130)" onmouseover="showTip(event, 'fs53', 130)" class="i">write</span> <span class="n">20</span>
  <span class="k">return</span> <span class="s">&quot;</span><span class="s">world</span><span class="s">&quot;</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs61', 131)" onmouseover="showTip(event, 'fs61', 131)" class="i">demo4</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 132)" onmouseover="showTip(event, 'fs24', 132)" class="i">update</span> {
  <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs62', 133)" onmouseover="showTip(event, 'fs62', 133)" class="i">w</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs60', 134)" onmouseover="showTip(event, 'fs60', 134)" class="i">demo3</span>
  <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs53', 135)" onmouseover="showTip(event, 'fs53', 135)" class="i">write</span> <span class="n">10</span>
  <span class="k">return</span> <span class="s">&quot;</span><span class="s">Hello</span><span class="s"> </span><span class="s">&quot;</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs62', 136)" onmouseover="showTip(event, 'fs62', 136)" class="i">w</span> }

<span onmouseout="hideTip(event, 'fs61', 137)" onmouseover="showTip(event, 'fs61', 137)" class="i">demo4</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs56', 138)" onmouseover="showTip(event, 'fs56', 138)" class="i">writeRun</span></pre>
</td>
</tr>
</table>

<h2>Adding fancy things</h2>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs12', 139)" onmouseover="showTip(event, 'fs12', 139)" class="i">UpdateBuilder</span> <span class="k">with</span>
  <span class="k">member</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs13', 140)" onmouseover="showTip(event, 'fs13', 140)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 141)" onmouseover="showTip(event, 'fs63', 141)" class="i">Zero</span>() <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 142)" onmouseover="showTip(event, 'fs13', 142)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs64', 143)" onmouseover="showTip(event, 'fs64', 143)" class="i">Return</span>(())
  <span class="k">member</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs13', 144)" onmouseover="showTip(event, 'fs13', 144)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs65', 145)" onmouseover="showTip(event, 'fs65', 145)" class="i">Delay</span>(<span onmouseout="hideTip(event, 'fs66', 146)" onmouseover="showTip(event, 'fs66', 146)" class="i">f</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 147)" onmouseover="showTip(event, 'fs13', 147)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 148)" onmouseover="showTip(event, 'fs67', 148)" class="i">Bind</span>(<span onmouseout="hideTip(event, 'fs13', 149)" onmouseover="showTip(event, 'fs13', 149)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 150)" onmouseover="showTip(event, 'fs68', 150)" class="i">Zero</span>(), <span onmouseout="hideTip(event, 'fs66', 151)" onmouseover="showTip(event, 'fs66', 151)" class="i">f</span>)
  <span class="k">member</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs13', 152)" onmouseover="showTip(event, 'fs13', 152)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs69', 153)" onmouseover="showTip(event, 'fs69', 153)" class="i">Combine</span>(<span onmouseout="hideTip(event, 'fs70', 154)" onmouseover="showTip(event, 'fs70', 154)" class="i">c1</span>, <span onmouseout="hideTip(event, 'fs71', 155)" onmouseover="showTip(event, 'fs71', 155)" class="i">c2</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 156)" onmouseover="showTip(event, 'fs13', 156)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 157)" onmouseover="showTip(event, 'fs67', 157)" class="i">Bind</span>(<span onmouseout="hideTip(event, 'fs70', 158)" onmouseover="showTip(event, 'fs70', 158)" class="i">c1</span>, <span class="k">fun</span> () <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs71', 159)" onmouseover="showTip(event, 'fs71', 159)" class="i">c2</span>)
  <span class="k">member</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs13', 160)" onmouseover="showTip(event, 'fs13', 160)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs72', 161)" onmouseover="showTip(event, 'fs72', 161)" class="i">ReturnFrom</span>(<span onmouseout="hideTip(event, 'fs73', 162)" onmouseover="showTip(event, 'fs73', 162)" class="i">m</span> <span class="o">:</span> <span onmouseout="hideTip(event, 'fs4', 163)" onmouseover="showTip(event, 'fs4', 163)" class="i">UpdateMonad</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">S</span>, <span class="o">&#39;</span><span class="i">P</span>, <span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs73', 164)" onmouseover="showTip(event, 'fs73', 164)" class="i">m</span>
  <span class="k">member</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs13', 165)" onmouseover="showTip(event, 'fs13', 165)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs74', 166)" onmouseover="showTip(event, 'fs74', 166)" class="i">Using</span>(<span onmouseout="hideTip(event, 'fs75', 167)" onmouseover="showTip(event, 'fs75', 167)" class="i">r</span>,<span onmouseout="hideTip(event, 'fs76', 168)" onmouseover="showTip(event, 'fs76', 168)" class="i">f</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 169)" onmouseover="showTip(event, 'fs5', 169)" class="i">UM</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs55', 170)" onmouseover="showTip(event, 'fs55', 170)" class="i">s</span> <span class="k">-&gt;</span> 
    <span class="k">use</span> <span onmouseout="hideTip(event, 'fs77', 171)" onmouseover="showTip(event, 'fs77', 171)" class="i">rr</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs75', 172)" onmouseover="showTip(event, 'fs75', 172)" class="i">r</span> <span class="k">in</span> <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs5', 173)" onmouseover="showTip(event, 'fs5', 173)" class="i">UM</span> <span onmouseout="hideTip(event, 'fs78', 174)" onmouseover="showTip(event, 'fs78', 174)" class="i">g</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs76', 175)" onmouseover="showTip(event, 'fs76', 175)" class="i">f</span> <span onmouseout="hideTip(event, 'fs77', 176)" onmouseover="showTip(event, 'fs77', 176)" class="i">rr</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs78', 177)" onmouseover="showTip(event, 'fs78', 177)" class="i">g</span> <span onmouseout="hideTip(event, 'fs55', 178)" onmouseover="showTip(event, 'fs55', 178)" class="i">s</span>)
  <span class="k">member</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs13', 179)" onmouseover="showTip(event, 'fs13', 179)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs79', 180)" onmouseover="showTip(event, 'fs79', 180)" class="i">For</span>(<span onmouseout="hideTip(event, 'fs80', 181)" onmouseover="showTip(event, 'fs80', 181)" class="i">sq</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs81', 182)" onmouseover="showTip(event, 'fs81', 182)" class="i">seq</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">V</span><span class="o">&gt;</span>, <span onmouseout="hideTip(event, 'fs82', 183)" onmouseover="showTip(event, 'fs82', 183)" class="i">f</span><span class="o">:</span><span class="o">&#39;</span><span class="i">V</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 184)" onmouseover="showTip(event, 'fs4', 184)" class="i">UpdateMonad</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">S</span>, <span class="o">&#39;</span><span class="i">P</span>, <span onmouseout="hideTip(event, 'fs6', 185)" onmouseover="showTip(event, 'fs6', 185)" class="i">unit</span><span class="o">&gt;</span>) <span class="o">=</span> 
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs83', 186)" onmouseover="showTip(event, 'fs83', 186)" class="i">loop</span> (<span onmouseout="hideTip(event, 'fs84', 187)" onmouseover="showTip(event, 'fs84', 187)" class="i">en</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs85', 188)" onmouseover="showTip(event, 'fs85', 188)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs86', 189)" onmouseover="showTip(event, 'fs86', 189)" class="i">Collections</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs87', 190)" onmouseover="showTip(event, 'fs87', 190)" class="i">Generic</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs88', 191)" onmouseover="showTip(event, 'fs88', 191)" class="i">IEnumerator</span><span class="o">&lt;</span>_<span class="o">&gt;</span>) <span class="o">=</span> 
      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs84', 192)" onmouseover="showTip(event, 'fs84', 192)" class="i">en</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs89', 193)" onmouseover="showTip(event, 'fs89', 193)" class="i">MoveNext</span>() <span class="k">then</span> <span onmouseout="hideTip(event, 'fs13', 194)" onmouseover="showTip(event, 'fs13', 194)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 195)" onmouseover="showTip(event, 'fs67', 195)" class="i">Bind</span>(<span onmouseout="hideTip(event, 'fs82', 196)" onmouseover="showTip(event, 'fs82', 196)" class="i">f</span> <span onmouseout="hideTip(event, 'fs84', 197)" onmouseover="showTip(event, 'fs84', 197)" class="i">en</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 198)" onmouseover="showTip(event, 'fs90', 198)" class="i">Current</span>, <span class="k">fun</span> _ <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs83', 199)" onmouseover="showTip(event, 'fs83', 199)" class="i">loop</span> <span onmouseout="hideTip(event, 'fs84', 200)" onmouseover="showTip(event, 'fs84', 200)" class="i">en</span>)
      <span class="k">else</span> <span onmouseout="hideTip(event, 'fs13', 201)" onmouseover="showTip(event, 'fs13', 201)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 202)" onmouseover="showTip(event, 'fs68', 202)" class="i">Zero</span>()
    <span onmouseout="hideTip(event, 'fs13', 203)" onmouseover="showTip(event, 'fs13', 203)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs91', 204)" onmouseover="showTip(event, 'fs91', 204)" class="i">Using</span>(<span onmouseout="hideTip(event, 'fs80', 205)" onmouseover="showTip(event, 'fs80', 205)" class="i">sq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs92', 206)" onmouseover="showTip(event, 'fs92', 206)" class="i">GetEnumerator</span>(), <span onmouseout="hideTip(event, 'fs83', 207)" onmouseover="showTip(event, 'fs83', 207)" class="i">loop</span>)
  <span class="k">member</span> <span class="k">inline</span> <span onmouseout="hideTip(event, 'fs13', 208)" onmouseover="showTip(event, 'fs13', 208)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs93', 209)" onmouseover="showTip(event, 'fs93', 209)" class="i">While</span>(<span onmouseout="hideTip(event, 'fs94', 210)" onmouseover="showTip(event, 'fs94', 210)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs95', 211)" onmouseover="showTip(event, 'fs95', 211)" class="i">f</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs6', 212)" onmouseover="showTip(event, 'fs6', 212)" class="i">unit</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 213)" onmouseover="showTip(event, 'fs4', 213)" class="i">UpdateMonad</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">S</span>, <span class="o">&#39;</span><span class="i">P</span>, <span onmouseout="hideTip(event, 'fs6', 214)" onmouseover="showTip(event, 'fs6', 214)" class="i">unit</span><span class="o">&gt;</span>) <span class="o">=</span>
    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs96', 215)" onmouseover="showTip(event, 'fs96', 215)" class="i">loop</span> () <span class="o">=</span> 
      <span class="k">if</span> <span onmouseout="hideTip(event, 'fs94', 216)" onmouseover="showTip(event, 'fs94', 216)" class="i">t</span>() <span class="k">then</span> <span onmouseout="hideTip(event, 'fs13', 217)" onmouseover="showTip(event, 'fs13', 217)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs67', 218)" onmouseover="showTip(event, 'fs67', 218)" class="i">Bind</span>(<span onmouseout="hideTip(event, 'fs95', 219)" onmouseover="showTip(event, 'fs95', 219)" class="i">f</span>(), <span onmouseout="hideTip(event, 'fs96', 220)" onmouseover="showTip(event, 'fs96', 220)" class="i">loop</span>)
      <span class="k">else</span> <span onmouseout="hideTip(event, 'fs13', 221)" onmouseover="showTip(event, 'fs13', 221)" class="i">x</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs68', 222)" onmouseover="showTip(event, 'fs68', 222)" class="i">Zero</span>()
    <span onmouseout="hideTip(event, 'fs96', 223)" onmouseover="showTip(event, 'fs96', 223)" class="i">loop</span>()</pre>
</td>
</tr>
</table>

<h2>State monad</h2>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs97', 224)" onmouseover="showTip(event, 'fs97', 224)" class="i">StateAction</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">T</span><span class="o">&gt;</span> <span class="o">=</span> 
  | <span onmouseout="hideTip(event, 'fs98', 225)" onmouseover="showTip(event, 'fs98', 225)" class="i">Set</span> <span class="k">of</span> <span class="o">&#39;</span><span class="i">T</span> | <span onmouseout="hideTip(event, 'fs99', 226)" onmouseover="showTip(event, 'fs99', 226)" class="i">SetNop</span>
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs100', 227)" onmouseover="showTip(event, 'fs100', 227)" class="i">Unit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs99', 228)" onmouseover="showTip(event, 'fs99', 228)" class="i">SetNop</span>
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs101', 229)" onmouseover="showTip(event, 'fs101', 229)" class="i">Combine</span>(<span onmouseout="hideTip(event, 'fs102', 230)" onmouseover="showTip(event, 'fs102', 230)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs103', 231)" onmouseover="showTip(event, 'fs103', 231)" class="i">b</span>) <span class="o">=</span> 
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs102', 232)" onmouseover="showTip(event, 'fs102', 232)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs103', 233)" onmouseover="showTip(event, 'fs103', 233)" class="i">b</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs99', 234)" onmouseover="showTip(event, 'fs99', 234)" class="i">SetNop</span>, <span onmouseout="hideTip(event, 'fs104', 235)" onmouseover="showTip(event, 'fs104', 235)" class="i">v</span> | <span onmouseout="hideTip(event, 'fs104', 236)" onmouseover="showTip(event, 'fs104', 236)" class="i">v</span>, <span onmouseout="hideTip(event, 'fs99', 237)" onmouseover="showTip(event, 'fs99', 237)" class="i">SetNop</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs104', 238)" onmouseover="showTip(event, 'fs104', 238)" class="i">v</span> | <span onmouseout="hideTip(event, 'fs98', 239)" onmouseover="showTip(event, 'fs98', 239)" class="i">Set</span> <span onmouseout="hideTip(event, 'fs105', 240)" onmouseover="showTip(event, 'fs105', 240)" class="i">a</span>, <span onmouseout="hideTip(event, 'fs98', 241)" onmouseover="showTip(event, 'fs98', 241)" class="i">Set</span> <span onmouseout="hideTip(event, 'fs106', 242)" onmouseover="showTip(event, 'fs106', 242)" class="i">b</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs98', 243)" onmouseover="showTip(event, 'fs98', 243)" class="i">Set</span> <span onmouseout="hideTip(event, 'fs106', 244)" onmouseover="showTip(event, 'fs106', 244)" class="i">b</span>
  <span class="k">static</span> <span class="k">member</span> <span onmouseout="hideTip(event, 'fs107', 245)" onmouseover="showTip(event, 'fs107', 245)" class="i">Apply</span>(<span onmouseout="hideTip(event, 'fs32', 246)" onmouseover="showTip(event, 'fs32', 246)" class="i">s</span>, <span onmouseout="hideTip(event, 'fs108', 247)" onmouseover="showTip(event, 'fs108', 247)" class="i">p</span>) <span class="o">=</span> <span class="k">match</span> <span onmouseout="hideTip(event, 'fs108', 248)" onmouseover="showTip(event, 'fs108', 248)" class="i">p</span> <span class="k">with</span> <span onmouseout="hideTip(event, 'fs99', 249)" onmouseover="showTip(event, 'fs99', 249)" class="i">SetNop</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs32', 250)" onmouseover="showTip(event, 'fs32', 250)" class="i">s</span> | <span onmouseout="hideTip(event, 'fs98', 251)" onmouseover="showTip(event, 'fs98', 251)" class="i">Set</span> <span onmouseout="hideTip(event, 'fs32', 252)" onmouseover="showTip(event, 'fs32', 252)" class="i">s</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs32', 253)" onmouseover="showTip(event, 'fs32', 253)" class="i">s</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs109', 254)" onmouseover="showTip(event, 'fs109', 254)" class="i">set</span> <span onmouseout="hideTip(event, 'fs32', 255)" onmouseover="showTip(event, 'fs32', 255)" class="i">s</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 256)" onmouseover="showTip(event, 'fs5', 256)" class="i">UM</span> (<span class="k">fun</span> _ <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs98', 257)" onmouseover="showTip(event, 'fs98', 257)" class="i">Set</span> <span onmouseout="hideTip(event, 'fs32', 258)" onmouseover="showTip(event, 'fs32', 258)" class="i">s</span>,()))
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs110', 259)" onmouseover="showTip(event, 'fs110', 259)" class="i">get</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 260)" onmouseover="showTip(event, 'fs5', 260)" class="i">UM</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs32', 261)" onmouseover="showTip(event, 'fs32', 261)" class="i">s</span> <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs99', 262)" onmouseover="showTip(event, 'fs99', 262)" class="i">SetNop</span>, <span onmouseout="hideTip(event, 'fs32', 263)" onmouseover="showTip(event, 'fs32', 263)" class="i">s</span>))
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs111', 264)" onmouseover="showTip(event, 'fs111', 264)" class="i">setRun</span> <span onmouseout="hideTip(event, 'fs32', 265)" onmouseover="showTip(event, 'fs32', 265)" class="i">s</span> (<span onmouseout="hideTip(event, 'fs5', 266)" onmouseover="showTip(event, 'fs5', 266)" class="i">UM</span> <span onmouseout="hideTip(event, 'fs112', 267)" onmouseover="showTip(event, 'fs112', 267)" class="i">f</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs112', 268)" onmouseover="showTip(event, 'fs112', 268)" class="i">f</span> <span onmouseout="hideTip(event, 'fs32', 269)" onmouseover="showTip(event, 'fs32', 269)" class="i">s</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs37', 270)" onmouseover="showTip(event, 'fs37', 270)" class="i">snd</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs113', 271)" onmouseover="showTip(event, 'fs113', 271)" class="i">demo5</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 272)" onmouseover="showTip(event, 'fs24', 272)" class="i">update</span> { 
  <span class="k">let!</span> <span onmouseout="hideTip(event, 'fs114', 273)" onmouseover="showTip(event, 'fs114', 273)" class="i">v</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs110', 274)" onmouseover="showTip(event, 'fs110', 274)" class="i">get</span>
  <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs109', 275)" onmouseover="showTip(event, 'fs109', 275)" class="i">set</span> (<span onmouseout="hideTip(event, 'fs114', 276)" onmouseover="showTip(event, 'fs114', 276)" class="i">v</span> <span class="o">+</span> <span class="n">1</span>) }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs115', 277)" onmouseover="showTip(event, 'fs115', 277)" class="i">demo6</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 278)" onmouseover="showTip(event, 'fs24', 278)" class="i">update</span> {
  <span class="k">for</span> <span onmouseout="hideTip(event, 'fs116', 279)" onmouseover="showTip(event, 'fs116', 279)" class="i">i</span> <span class="k">in</span> <span class="n">0</span> <span class="o">..</span> <span class="n">10</span> <span class="k">do</span> 
    <span class="k">do!</span> <span onmouseout="hideTip(event, 'fs113', 280)" onmouseover="showTip(event, 'fs113', 280)" class="i">demo5</span>
  <span class="k">return!</span> <span onmouseout="hideTip(event, 'fs110', 281)" onmouseover="showTip(event, 'fs110', 281)" class="i">get</span> }

<span onmouseout="hideTip(event, 'fs115', 282)" onmouseover="showTip(event, 'fs115', 282)" class="i">demo6</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs111', 283)" onmouseover="showTip(event, 'fs111', 283)" class="i">setRun</span> <span class="n">0</span></pre>
</td>
</tr>
</table>

<h2>Conclusions</h2>

<p>People coming to F# from the Haskell background often dislike the fact that
F# does not let you write code polymorphic over monads and that computation
expressions always explicitly state the type of computations such as 
<code>async { .. }</code>. I think there are good reasons for this and tried to explain some
of them in <a href="http://localhost:8080/blog/2013/computation-zoo-padl">a recent blog post and PADL paper</a>.</p>

<p>As a result, using reader, writer and state monads in F# was always a bit 
cumbersome. In this blog post, I looked at an F# implementation of the recent
idea called <em>update monads</em> (see <a href="http://www.paper.net">the original paper (PDF)</a>), which unifies
the three state-related monads into a single type. This works very nicely with F#
- we can define just a single computation builder for all state-related computations
and then define a concrete state-related monad by defining two simple types.
I used the approach to define a reader monad, writer monad useful for logging and
a state monad (that keeps a state and allows changing it).</p>

<p>I guess that making update monads part of standard library and standard programming
style in Haskell will be tricky because of historical reasons. However, for F#
libraries that try to make purely functional programming easier, I think that 
update monads are the way to go.</p>

<div class="tip" id="fs1">type Reader&lt;&#39;TState,&#39;T&gt; = &#39;TState -&gt; &#39;T<br /><br />Full name: Update-monads_.Reader&lt;_,_&gt;<br /><em><br /><br />&#160;Given a readonly state, produces a value</em></div>
<div class="tip" id="fs2">type Writer&lt;&#39;TState,&#39;T&gt; = &#39;TState * &#39;T<br /><br />Full name: Update-monads_.Writer&lt;_,_&gt;<br /><em><br /><br />&#160;Produces a value together with additional state</em></div>
<div class="tip" id="fs3">type State&lt;&#39;TState,&#39;T&gt; = &#39;TState -&gt; &#39;TState * &#39;T<br /><br />Full name: Update-monads_.State&lt;_,_&gt;<br /><em><br /><br />&#160;Given state, produces new state &amp; a value</em></div>
<div class="tip" id="fs4">type UpdateMonad&lt;&#39;TState,&#39;TAction,&#39;T&gt; = | UM of (&#39;TState -&gt; &#39;TAction * &#39;T)<br /><br />Full name: Update-monads_.UpdateMonad&lt;_,_,_&gt;<br /><em><br /><br />&#160;Represents an update monad - given a state, produce <br />&#160;value and an action that can be applied to the state</em></div>
<div class="tip" id="fs5">union case UpdateMonad.UM: (&#39;TState -&gt; &#39;TAction * &#39;T) -&gt; UpdateMonad&lt;&#39;TState,&#39;TAction,&#39;T&gt;</div>
<div class="tip" id="fs6">Multiple items<br />val unit : unit -&gt; &#39;S (requires member get_Unit)<br /><br />Full name: Update-monads_.unit<br /><br />--------------------<br />type unit = Unit<br /><br />Full name: Microsoft.FSharp.Core.unit</div>
<div class="tip" id="fs7">val a : &#39;S (requires member Combine)</div>
<div class="tip" id="fs8">val b : &#39;S (requires member Combine)</div>
<div class="tip" id="fs9">val apply : s:&#39;S -&gt; a:&#39;A -&gt; &#39;S (requires member Apply)<br /><br />Full name: Update-monads_.apply</div>
<div class="tip" id="fs10">val s : &#39;S</div>
<div class="tip" id="fs11">val a : &#39;A (requires member Apply)</div>
<div class="tip" id="fs12">Multiple items<br />type UpdateBuilder =<br />&#160;&#160;new : unit -&gt; UpdateBuilder<br />&#160;&#160;member Bind : UpdateMonad&lt;&#39;S,&#39;P,&#39;T&gt; * f:(&#39;T -&gt; UpdateMonad&lt;&#39;S,&#39;P,&#39;R&gt;) -&gt; UpdateMonad&lt;&#39;S,&#39;P,&#39;R&gt; (requires member Combine and member Apply)<br />&#160;&#160;member Combine : c1:UpdateMonad&lt;&#39;a,&#39;b,unit&gt; * c2:UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt; -&gt; UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt; (requires member Combine and member Apply)<br />&#160;&#160;member Delay : f:(unit -&gt; UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt;) -&gt; UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt; (requires member get_Unit and member Combine and member Apply)<br />&#160;&#160;member For : sq:seq&lt;&#39;V&gt; * f:(&#39;V -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt;) -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt; (requires member Combine and member Apply and member get_Unit)<br />&#160;&#160;member Return : v:&#39;T -&gt; UpdateMonad&lt;&#39;S,&#39;A,&#39;T&gt; (requires member get_Unit)<br />&#160;&#160;member ReturnFrom : m:UpdateMonad&lt;&#39;S,&#39;P,&#39;T&gt; -&gt; UpdateMonad&lt;&#39;S,&#39;P,&#39;T&gt;<br />&#160;&#160;member Using : r:&#39;a * f:(&#39;a -&gt; UpdateMonad&lt;&#39;b,&#39;c,&#39;d&gt;) -&gt; UpdateMonad&lt;&#39;b,&#39;c,&#39;d&gt; (requires &#39;a :&gt; IDisposable)<br />&#160;&#160;member While : t:(unit -&gt; bool) * f:(unit -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt;) -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt; (requires member Combine and member Apply and member get_Unit)<br />&#160;&#160;member Zero : unit -&gt; UpdateMonad&lt;&#39;a,&#39;b,unit&gt; (requires member get_Unit)<br /><br />Full name: Update-monads_.UpdateBuilder<br /><br />--------------------<br />new : unit -&gt; UpdateBuilder</div>
<div class="tip" id="fs13">val x : UpdateBuilder</div>
<div class="tip" id="fs14">member UpdateBuilder.Return : v:&#39;T -&gt; UpdateMonad&lt;&#39;S,&#39;A,&#39;T&gt; (requires member get_Unit)<br /><br />Full name: Update-monads_.UpdateBuilder.Return<br /><em><br /><br />&#160;Returns the specified value, together<br />&#160;with empty action obtained using &#39;unit&#39;</em></div>
<div class="tip" id="fs15">val v : &#39;T</div>
<div class="tip" id="fs16">member UpdateBuilder.Bind : UpdateMonad&lt;&#39;S,&#39;P,&#39;T&gt; * f:(&#39;T -&gt; UpdateMonad&lt;&#39;S,&#39;P,&#39;R&gt;) -&gt; UpdateMonad&lt;&#39;S,&#39;P,&#39;R&gt; (requires member Combine and member Apply)<br /><br />Full name: Update-monads_.UpdateBuilder.Bind<br /><em><br /><br />&#160;Compose two update monad computations</em></div>
<div class="tip" id="fs17">val u1 : (&#39;S -&gt; &#39;P * &#39;T) (requires member Combine and member Apply)</div>
<div class="tip" id="fs18">val f : (&#39;T -&gt; UpdateMonad&lt;&#39;S,&#39;P,&#39;R&gt;) (requires member Combine and member Apply)</div>
<div class="tip" id="fs19">val a1 : &#39;P (requires member Combine and member Apply)</div>
<div class="tip" id="fs20">val x : &#39;T</div>
<div class="tip" id="fs21">val u2 : (&#39;S -&gt; &#39;P * &#39;R) (requires member Combine and member Apply)</div>
<div class="tip" id="fs22">val a2 : &#39;P (requires member Combine and member Apply)</div>
<div class="tip" id="fs23">val y : &#39;R</div>
<div class="tip" id="fs24">val update : UpdateBuilder<br /><br />Full name: Update-monads_.update<br /><em><br /><br />&#160;Instance of the computation builder<br />&#160;that defines the update { .. } block</em></div>
<div class="tip" id="fs25">type ReaderState = int<br /><br />Full name: Update-monads_.ReaderState<br /><em><br /><br />&#160;The state of the reader is &#39;int&#39;</em></div>
<div class="tip" id="fs26">Multiple items<br />val int : value:&#39;T -&gt; int (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.int<br /><br />--------------------<br />type int = int32<br /><br />Full name: Microsoft.FSharp.Core.int<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; = int<br /><br />Full name: Microsoft.FSharp.Core.int&lt;_&gt;</div>
<div class="tip" id="fs27">type ReaderAction =<br />&#160;&#160;| NoAction<br />&#160;&#160;static member Apply : s:&#39;a * NoAction:ReaderAction -&gt; &#39;a<br />&#160;&#160;static member Combine : NoAction:ReaderAction * NoAction:ReaderAction -&gt; ReaderAction<br />&#160;&#160;static member Unit : ReaderAction<br /><br />Full name: Update-monads_.ReaderAction<br /><em><br /><br />&#160;Trivial monoid of actions </em></div>
<div class="tip" id="fs28">union case ReaderAction.NoAction: ReaderAction</div>
<div class="tip" id="fs29">static member ReaderAction.Unit : ReaderAction<br /><br />Full name: Update-monads_.ReaderAction.Unit</div>
<div class="tip" id="fs30">static member ReaderAction.Combine : NoAction:ReaderAction * NoAction:ReaderAction -&gt; ReaderAction<br /><br />Full name: Update-monads_.ReaderAction.Combine</div>
<div class="tip" id="fs31">static member ReaderAction.Apply : s:&#39;a * NoAction:ReaderAction -&gt; &#39;a<br /><br />Full name: Update-monads_.ReaderAction.Apply</div>
<div class="tip" id="fs32">val s : &#39;a</div>
<div class="tip" id="fs33">val read : UpdateMonad&lt;ReaderState,ReaderAction,ReaderState&gt;<br /><br />Full name: Update-monads_.read<br /><em><br /><br />&#160;Read the current state (int) and return it as &#39;int&#39;</em></div>
<div class="tip" id="fs34">val s : ReaderState</div>
<div class="tip" id="fs35">val readRun : s:ReaderState -&gt; UpdateMonad&lt;ReaderState,&#39;a,&#39;b&gt; -&gt; &#39;b<br /><br />Full name: Update-monads_.readRun<br /><em><br /><br />&#160;Run computation and return the result </em></div>
<div class="tip" id="fs36">val f : (ReaderState -&gt; &#39;a * &#39;b)</div>
<div class="tip" id="fs37">val snd : tuple:(&#39;T1 * &#39;T2) -&gt; &#39;T2<br /><br />Full name: Microsoft.FSharp.Core.Operators.snd</div>
<div class="tip" id="fs38">val demo1 : UpdateMonad&lt;ReaderState,ReaderAction,ReaderState&gt;<br /><br />Full name: Update-monads_.demo1<br /><em><br /><br />&#160;Returns state + 1</em></div>
<div class="tip" id="fs39">val v : ReaderState</div>
<div class="tip" id="fs40">val demo2 : UpdateMonad&lt;ReaderState,ReaderAction,ReaderState&gt;<br /><br />Full name: Update-monads_.demo2<br /><em><br /><br />&#160;Returns the result of demo1 + 1</em></div>
<div class="tip" id="fs41">type WriterState = | NoState<br /><br />Full name: Update-monads_.WriterState</div>
<div class="tip" id="fs42">union case WriterState.NoState: WriterState</div>
<div class="tip" id="fs43">type WriterAction&lt;&#39;TLog&gt; =<br />&#160;&#160;| Log of &#39;TLog list<br />&#160;&#160;static member Apply : NoState:WriterState * &#39;a -&gt; WriterState<br />&#160;&#160;static member Combine : WriterAction&lt;&#39;a&gt; * WriterAction&lt;&#39;a&gt; -&gt; WriterAction&lt;&#39;a&gt;<br />&#160;&#160;static member Unit : WriterAction&lt;int&gt;<br /><br />Full name: Update-monads_.WriterAction&lt;_&gt;</div>
<div class="tip" id="fs44">union case WriterAction.Log: &#39;TLog list -&gt; WriterAction&lt;&#39;TLog&gt;</div>
<div class="tip" id="fs45">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>
<div class="tip" id="fs46">static member WriterAction.Unit : WriterAction&lt;int&gt;<br /><br />Full name: Update-monads_.WriterAction`1.Unit</div>
<div class="tip" id="fs47">static member WriterAction.Combine : WriterAction&lt;&#39;a&gt; * WriterAction&lt;&#39;a&gt; -&gt; WriterAction&lt;&#39;a&gt;<br /><br />Full name: Update-monads_.WriterAction`1.Combine</div>
<div class="tip" id="fs48">val a : &#39;a list</div>
<div class="tip" id="fs49">val b : &#39;a list</div>
<div class="tip" id="fs50">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs51">val append : list1:&#39;T list -&gt; list2:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.append</div>
<div class="tip" id="fs52">static member WriterAction.Apply : NoState:WriterState * &#39;a -&gt; WriterState<br /><br />Full name: Update-monads_.WriterAction`1.Apply</div>
<div class="tip" id="fs53">val write : v:&#39;a -&gt; UpdateMonad&lt;&#39;b,WriterAction&lt;&#39;a&gt;,unit&gt;<br /><br />Full name: Update-monads_.write</div>
<div class="tip" id="fs54">val v : &#39;a</div>
<div class="tip" id="fs55">val s : &#39;b</div>
<div class="tip" id="fs56">val writeRun : UpdateMonad&lt;WriterState,WriterAction&lt;&#39;a&gt;,&#39;b&gt; -&gt; &#39;a list * &#39;b<br /><br />Full name: Update-monads_.writeRun</div>
<div class="tip" id="fs57">val f : (WriterState -&gt; WriterAction&lt;&#39;a&gt; * &#39;b)</div>
<div class="tip" id="fs58">val l : &#39;a list</div>
<div class="tip" id="fs59">val v : &#39;b</div>
<div class="tip" id="fs60">val demo3 : UpdateMonad&lt;WriterState,WriterAction&lt;int&gt;,string&gt;<br /><br />Full name: Update-monads_.demo3</div>
<div class="tip" id="fs61">val demo4 : UpdateMonad&lt;WriterState,WriterAction&lt;int&gt;,string&gt;<br /><br />Full name: Update-monads_.demo4</div>
<div class="tip" id="fs62">val w : string</div>
<div class="tip" id="fs63">member UpdateBuilder.Zero : unit -&gt; UpdateMonad&lt;&#39;a,&#39;b,unit&gt; (requires member get_Unit)<br /><br />Full name: Update-monads_.UpdateBuilder.Zero</div>
<div class="tip" id="fs64">member UpdateBuilder.Return : v:&#39;T -&gt; UpdateMonad&lt;&#39;S,&#39;A,&#39;T&gt; (requires member get_Unit)<br /><em><br /><br />&#160;Returns the specified value, together<br />&#160;with empty action obtained using &#39;unit&#39;</em></div>
<div class="tip" id="fs65">member UpdateBuilder.Delay : f:(unit -&gt; UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt;) -&gt; UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt; (requires member get_Unit and member Combine and member Apply)<br /><br />Full name: Update-monads_.UpdateBuilder.Delay</div>
<div class="tip" id="fs66">val f : (unit -&gt; UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt;) (requires member get_Unit and member Combine and member Apply)</div>
<div class="tip" id="fs67">member UpdateBuilder.Bind : UpdateMonad&lt;&#39;S,&#39;P,&#39;T&gt; * f:(&#39;T -&gt; UpdateMonad&lt;&#39;S,&#39;P,&#39;R&gt;) -&gt; UpdateMonad&lt;&#39;S,&#39;P,&#39;R&gt; (requires member Combine and member Apply)<br /><em><br /><br />&#160;Compose two update monad computations</em></div>
<div class="tip" id="fs68">member UpdateBuilder.Zero : unit -&gt; UpdateMonad&lt;&#39;a,&#39;b,unit&gt; (requires member get_Unit)</div>
<div class="tip" id="fs69">member UpdateBuilder.Combine : c1:UpdateMonad&lt;&#39;a,&#39;b,unit&gt; * c2:UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt; -&gt; UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt; (requires member Combine and member Apply)<br /><br />Full name: Update-monads_.UpdateBuilder.Combine</div>
<div class="tip" id="fs70">val c1 : UpdateMonad&lt;&#39;a,&#39;b,unit&gt; (requires member Combine and member Apply)</div>
<div class="tip" id="fs71">val c2 : UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt; (requires member Combine and member Apply)</div>
<div class="tip" id="fs72">member UpdateBuilder.ReturnFrom : m:UpdateMonad&lt;&#39;S,&#39;P,&#39;T&gt; -&gt; UpdateMonad&lt;&#39;S,&#39;P,&#39;T&gt;<br /><br />Full name: Update-monads_.UpdateBuilder.ReturnFrom</div>
<div class="tip" id="fs73">val m : UpdateMonad&lt;&#39;S,&#39;P,&#39;T&gt;</div>
<div class="tip" id="fs74">member UpdateBuilder.Using : r:&#39;a * f:(&#39;a -&gt; UpdateMonad&lt;&#39;b,&#39;c,&#39;d&gt;) -&gt; UpdateMonad&lt;&#39;b,&#39;c,&#39;d&gt; (requires &#39;a :&gt; System.IDisposable)<br /><br />Full name: Update-monads_.UpdateBuilder.Using</div>
<div class="tip" id="fs75">val r : #System.IDisposable</div>
<div class="tip" id="fs76">val f : (#System.IDisposable -&gt; UpdateMonad&lt;&#39;b,&#39;c,&#39;d&gt;)</div>
<div class="tip" id="fs77">val rr : #System.IDisposable</div>
<div class="tip" id="fs78">val g : (&#39;b -&gt; &#39;c * &#39;d)</div>
<div class="tip" id="fs79">member UpdateBuilder.For : sq:seq&lt;&#39;V&gt; * f:(&#39;V -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt;) -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt; (requires member Combine and member Apply and member get_Unit)<br /><br />Full name: Update-monads_.UpdateBuilder.For</div>
<div class="tip" id="fs80">val sq : seq&lt;&#39;V&gt;</div>
<div class="tip" id="fs81">Multiple items<br />val seq : sequence:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.Operators.seq<br /><br />--------------------<br />type seq&lt;&#39;T&gt; = System.Collections.Generic.IEnumerable&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.seq&lt;_&gt;</div>
<div class="tip" id="fs82">val f : (&#39;V -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt;) (requires member Combine and member Apply and member get_Unit)</div>
<div class="tip" id="fs83">val loop : (System.Collections.Generic.IEnumerator&lt;&#39;V&gt; -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt;) (requires member Combine and member Apply and member get_Unit)</div>
<div class="tip" id="fs84">val en : System.Collections.Generic.IEnumerator&lt;&#39;V&gt;</div>
<div class="tip" id="fs85">namespace System</div>
<div class="tip" id="fs86">namespace System.Collections</div>
<div class="tip" id="fs87">namespace System.Collections.Generic</div>
<div class="tip" id="fs88">type IEnumerator&lt;&#39;T&gt; =<br />&#160;&#160;member Current : &#39;T<br /><br />Full name: System.Collections.Generic.IEnumerator&lt;_&gt;</div>
<div class="tip" id="fs89">System.Collections.IEnumerator.MoveNext() : bool</div>
<div class="tip" id="fs90">property System.Collections.Generic.IEnumerator.Current: &#39;V</div>
<div class="tip" id="fs91">member UpdateBuilder.Using : r:&#39;a * f:(&#39;a -&gt; UpdateMonad&lt;&#39;b,&#39;c,&#39;d&gt;) -&gt; UpdateMonad&lt;&#39;b,&#39;c,&#39;d&gt; (requires &#39;a :&gt; System.IDisposable)</div>
<div class="tip" id="fs92">System.Collections.Generic.IEnumerable.GetEnumerator() : System.Collections.Generic.IEnumerator&lt;&#39;V&gt;</div>
<div class="tip" id="fs93">member UpdateBuilder.While : t:(unit -&gt; bool) * f:(unit -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt;) -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt; (requires member Combine and member Apply and member get_Unit)<br /><br />Full name: Update-monads_.UpdateBuilder.While</div>
<div class="tip" id="fs94">val t : (unit -&gt; bool)</div>
<div class="tip" id="fs95">val f : (unit -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt;) (requires member Combine and member Apply and member get_Unit)</div>
<div class="tip" id="fs96">val loop : (unit -&gt; UpdateMonad&lt;&#39;S,&#39;P,unit&gt;) (requires member Combine and member Apply and member get_Unit)</div>
<div class="tip" id="fs97">type StateAction&lt;&#39;T&gt; =<br />&#160;&#160;| Set of &#39;T<br />&#160;&#160;| SetNop<br />&#160;&#160;static member Apply : s:&#39;a * p:StateAction&lt;&#39;a&gt; -&gt; &#39;a<br />&#160;&#160;static member Combine : a:StateAction&lt;&#39;a&gt; * b:StateAction&lt;&#39;a&gt; -&gt; StateAction&lt;&#39;a&gt;<br />&#160;&#160;static member Unit : StateAction&lt;int&gt;<br /><br />Full name: Update-monads_.StateAction&lt;_&gt;</div>
<div class="tip" id="fs98">Multiple items<br />union case StateAction.Set: &#39;T -&gt; StateAction&lt;&#39;T&gt;<br /><br />--------------------<br />module Set<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Set&lt;&#39;T (requires comparison)&gt; =<br />&#160;&#160;interface IComparable<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;interface ICollection&lt;&#39;T&gt;<br />&#160;&#160;new : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt;<br />&#160;&#160;member Add : value:&#39;T -&gt; Set&lt;&#39;T&gt;<br />&#160;&#160;member Contains : value:&#39;T -&gt; bool<br />&#160;&#160;override Equals : obj -&gt; bool<br />&#160;&#160;member IsProperSubsetOf : otherSet:Set&lt;&#39;T&gt; -&gt; bool<br />&#160;&#160;member IsProperSupersetOf : otherSet:Set&lt;&#39;T&gt; -&gt; bool<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Collections.Set&lt;_&gt;<br /><br />--------------------<br />new : elements:seq&lt;&#39;T&gt; -&gt; Set&lt;&#39;T&gt;</div>
<div class="tip" id="fs99">union case StateAction.SetNop: StateAction&lt;&#39;T&gt;</div>
<div class="tip" id="fs100">static member StateAction.Unit : StateAction&lt;int&gt;<br /><br />Full name: Update-monads_.StateAction`1.Unit</div>
<div class="tip" id="fs101">static member StateAction.Combine : a:StateAction&lt;&#39;a&gt; * b:StateAction&lt;&#39;a&gt; -&gt; StateAction&lt;&#39;a&gt;<br /><br />Full name: Update-monads_.StateAction`1.Combine</div>
<div class="tip" id="fs102">val a : StateAction&lt;&#39;a&gt;</div>
<div class="tip" id="fs103">val b : StateAction&lt;&#39;a&gt;</div>
<div class="tip" id="fs104">val v : StateAction&lt;&#39;a&gt;</div>
<div class="tip" id="fs105">val a : &#39;a</div>
<div class="tip" id="fs106">val b : &#39;a</div>
<div class="tip" id="fs107">static member StateAction.Apply : s:&#39;a * p:StateAction&lt;&#39;a&gt; -&gt; &#39;a<br /><br />Full name: Update-monads_.StateAction`1.Apply</div>
<div class="tip" id="fs108">val p : StateAction&lt;&#39;a&gt;</div>
<div class="tip" id="fs109">val set : s:&#39;a -&gt; UpdateMonad&lt;&#39;b,StateAction&lt;&#39;a&gt;,unit&gt;<br /><br />Full name: Update-monads_.set</div>
<div class="tip" id="fs110">val get : UpdateMonad&lt;&#39;a,StateAction&lt;&#39;b&gt;,&#39;a&gt;<br /><br />Full name: Update-monads_.get</div>
<div class="tip" id="fs111">val setRun : s:&#39;a -&gt; UpdateMonad&lt;&#39;a,&#39;b,&#39;c&gt; -&gt; &#39;c<br /><br />Full name: Update-monads_.setRun</div>
<div class="tip" id="fs112">val f : (&#39;a -&gt; &#39;b * &#39;c)</div>
<div class="tip" id="fs113">val demo5 : UpdateMonad&lt;int,StateAction&lt;int&gt;,unit&gt;<br /><br />Full name: Update-monads_.demo5</div>
<div class="tip" id="fs114">val v : int</div>
<div class="tip" id="fs115">val demo6 : UpdateMonad&lt;int,StateAction&lt;int&gt;,int&gt;<br /><br />Full name: Update-monads_.demo6</div>
<div class="tip" id="fs116">val i : int</div>


<div class="row">
  <div class="small-6 columns"><p class="post-discuss">
		Discuss <a href="http://twitter.com/tomaspetricek">on twitter</a>, <script type="text/javascript" src="http://www.reddit.com/buttonlite.js?i=0"></script>.<br />
		Send corrections via <a href="https://github.com/tpetricek/TomaspNet.Website">GitHub pull requests</a>.
	</p></div>
  <div class="small-6 columns">

<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style addthis_16x16_style">
<a class="addthis_button_twitter"></a>
<a class="addthis_button_reddit"></a>
<a class="addthis_button_google_plusone_share"></a>
<a class="addthis_button_hackernews"></a>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_compact"></a><a class="addthis_counter addthis_bubble_style"></a>
</div>
<script type="text/javascript">var addthis_config = { "data_track_addressbar": false };</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-521c32162e6001a0"></script>
<!-- AddThis Button END -->

<p class="post-meta">
  <span><strong>Published</strong>: Wednesday, 15 January 2014, 2:29 PM</span><br />      
  <span class="tags"><strong>Tags</strong>: f#, research, functional programming, monads</span>
</p>

  </div>
</div>

    </content>

  </div>
  <div class="large-4 columns" id="right-bar">
    <div class="right-item" id="right-calendar">
<script type="text/javascript">
  var monthNames =
    ["January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"];
  var d = new Date();
  var m = monthNames[d.getMonth()];
  var y = d.getFullYear();
  var ml = m.toLowerCase();
  document.writeln("<h4>Calendar - " + m + " " + y + "</h4>");
  document.writeln("<a href=\"http://tomasp.net/calendar/" + y + "/" + ml + ".html\">" +
    "<img src=\"http://tomasp.net/calendar/" + y + "/" + ml + "-preview.jpg\" style=\"border-style:none;\" />" +
    "</a>");
</script> 
<p>The calendar shows a new picture each month since 
  <a href="http://tomasp.net/calendar/2005">2005</a>, <a href="http://tomasp.net/calendar/2006">2006</a>, 
  <a href="http://tomasp.net/calendar/2007">2007</a>, <a href="http://tomasp.net/calendar/2008">2008</a>, 
  <a href="http://tomasp.net/calendar/2009">2009</a>, <a href="http://tomasp.net/calendar/2010">2010</a>, 
  <a href="http://tomasp.net/calendar/2011">2011</a>, <a href="http://tomasp.net/calendar/2012">2012</a>. <br />
  See the first photos of <a href="http://tomasp.net/calendar/2013">2013</a>.
</p>
</div>

    <h3>Welcome!</h3>
    <img src="http://tomasp.net/img/tomas.jpg" alt="Tomas Petricek" style="float:right;margin:10px 0px 10px 10px;" />
    <p>I'm an F# enthusiast, book author and a PhD student at the University of Cambridge.
      When offline, I enjoy traveling and taking pictures. You can find me at
      at <a href="http://twitter.com/tomaspetricek">@tomaspetricek</a> or email 
      <a href="mailto:tomas@tomasp.net">tomas@tomasp.net</a>.
    </p>

    <script type="text/javascript" src="http://tomasp.net/news/news.js"></script>
    <h4>What's new? &#160; <small><script type="text/javascript">document.write(news.date)</script></small></h4>
    <script>
      document.write(news.info);
    </script>

    <h4>Trainings and consulting</h4>
    <img src="http://tomasp.net/img/skillsmatter.png" alt="Tomas Petricek" style="float:right;margin:15px 0px 10px 10px;" />
    <p>I run F# and functional programming courses in <strong>London</strong>
      and <strong>New York</strong> with SkillsMatter.
    </p>
    <ul>
      <li>Check out our <a href="http://skillsmatter.com/course/scala/tomas-petricek-phil-trelford-fast-track-to-fsharp/ps-6679">Fast Track to F#</a> course</li>
      <li><a href="mailto:tomas@tomasp.net">Email me</a> for info about private trainings</li>
    </ul>
    
    <h4>F# Books and articles</h4>
    <div style="float:right;">
      <a href="http://www.amazon.com/gp/product/1933988924/ref=as_li_tf_il?ie=UTF8&amp;tag=httptomasnet-20&amp;linkCode=as2&amp;camp=217145&amp;creative=399369&amp;creativeASIN=1933988924">
        <img src="http://tomasp.net/img/rwfp.jpg" alt="Real World Functional Programming" style="float:right;margin:10px 0px 10px 10px;border-style:none;" />
      </a>
    </div>
    <p><a href="http://www.manning.com/petricek">Real World Functional Programming</a> explains functional
      concepts using F# and C#. You can get it from <a href="http://www.amazon.com/dp/1933988924?tag=httptomasnet-20&amp;camp=213381&amp;creative=390973&amp;linkCode=as4&amp;creativeASIN=1933988924&amp;adid=0F1DP260JGG4KY0CDGP6">Amazon.com</a>, <a href="https://www.amazon.co.uk/dp/1933988924?tag=tomasnet-21&amp;camp=1406&amp;creative=6394&amp;linkCode=as1&amp;creativeASIN=1933988924&amp;adid=1CTY87YCCQEJW965GNDF">Amazon.co.uk</a> or your favorite book store.
      Some chapters and new materials are also available on <a href="http://msdn.microsoft.com/en-us/library/hh314518.aspx">MSDN</a>.</p>
    
    <p>Currently, I'm putting together <a href="http://www.manning.com/petricek2/">F# Deep Dives</a> - a collection
      of practical F# essays written by community leaders and commercial users of F#.</p>
    <p>I also wrote a series of tutorials on <a href="http://www.tryfsharp.org/Learn/financial-computing">financial computing</a>
      for Try F# - an interactive environment that let's you try F# in the browser.</p>

    <h4>Research and teaching</h4>
    <img src="http://tomasp.net/img/cam.png" alt="University of Cambride" style="float:right;margin:25px 0px 10px 10px;" />
    <p>I'm finishing PhD in computer science at the <a href="http://www.cl.cam.ac.uk/">University of Cambridge</a>.
      I'm working on making better types for programs that run in rich context (like F# type providers, distributed 
      prog&shy;ramming or data-flow). See <a href="http://www.cl.cam.ac.uk/~tp322/">my academic page</a> for
      more.</p>

    <h4>Blog tags</h4>
    <p>

      <a href="http://tomasp.net/blog/tag/fsharp/">f#</a>&nbsp;(92),       <a href="http://tomasp.net/blog/tag/research/">research</a>&nbsp;(28),       <a href="http://tomasp.net/blog/tag/csharp/">c#</a>&nbsp;(30),       <a href="http://tomasp.net/blog/tag/functional-programming/">functional programming</a>&nbsp;(5),       <a href="http://tomasp.net/blog/tag/writing/">writing</a>&nbsp;(11),       <a href="http://tomasp.net/blog/tag/fsharp-data/">f# data</a>&nbsp;(3),       <a href="http://tomasp.net/blog/tag/open-source/">open source</a>&nbsp;(3),       <a href="http://tomasp.net/blog/tag/haskell/">haskell</a>&nbsp;(7),       <a href="http://tomasp.net/blog/tag/art/">art</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/fractals/">fractals</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/funscript/">funscript</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/talks/">talks</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/new-york/">new york</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/monads/">monads</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/manning/">manning</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/books/">books</a>&nbsp;(2),       <a href="http://tomasp.net/blog/tag/coeffects/">coeffects</a>&nbsp;(1),       <a href="http://tomasp.net/blog/tag/comonads/">comonads</a>&nbsp;(1),       <a href="http://tomasp.net/blog/tag/fake/">fake</a>&nbsp;(1),       <a href="http://tomasp.net/blog/tag/fsharp-formatting/">f# formatting</a>&nbsp;(1)    </p>

  </div>
</div>


  <div class="row" id="footer">
  <footer>   
    <div class="large-3 columns">
      <h4>Contact &amp; about</h4>
      <p>This site is hosted on GitHub and is generated using <a href="https://github.com/tpetricek/FSharp.Formatting">F# Formatting</a>.
        For more info, see the <a href="https://github.com/tpetricek/TomaspNet.Website">website source on GitHub</a>.
      </p>
      <p>Please submit issues &amp; corrections on GitHub. Use pull requests for minor corrections only.</p>
      <ul>
        <li>Email me: <a href="mailto:tomas@tomasp.net">tomas@tomasp.net</a></li>
        <li>Connect via Twitter: <a href="http://twitter.com/tomaspetricek">@tomaspetricek</a></li>
        <li>More: <a href="http://uk.linkedin.com/in/tomaspetricek">LinkedIn</a> | <a href="http://lanyrd.com/profile/tomasp/">Lanyrd</a> | <a href="https://github.com/tpetricek">GitHub</a></li>
      </ul>
    </div>
    <div class="large-7 columns">
    <h4>Blog archives <a href="http://tomasp.net/rss.xml"><img src="http://tomasp.net/img/rss.gif" /></a></h4>
      <a href="http://tomasp.net/blog/archive/january-2014/index.html">
        January 2014 (3)</a>,      <a href="http://tomasp.net/blog/archive/december-2013/index.html">
        December 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/november-2013/index.html">
        November 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/october-2013/index.html">
        October 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/september-2013/index.html">
        September 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/august-2013/index.html">
        August 2013 (2)</a>,      <a href="http://tomasp.net/blog/archive/may-2013/index.html">
        May 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/april-2013/index.html">
        April 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/march-2013/index.html">
        March 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/february-2013/index.html">
        February 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/january-2013/index.html">
        January 2013 (1)</a>,      <a href="http://tomasp.net/blog/archive/december-2012/index.html">
        December 2012 (2)</a>,      <a href="http://tomasp.net/blog/archive/october-2012/index.html">
        October 2012 (1)</a>,      <a href="http://tomasp.net/blog/archive/august-2012/index.html">
        August 2012 (3)</a>,      <a href="http://tomasp.net/blog/archive/june-2012/index.html">
        June 2012 (2)</a>,      <a href="http://tomasp.net/blog/archive/april-2012/index.html">
        April 2012 (1)</a>,      <a href="http://tomasp.net/blog/archive/march-2012/index.html">
        March 2012 (4)</a>,      <a href="http://tomasp.net/blog/archive/february-2012/index.html">
        February 2012 (5)</a>,      <a href="http://tomasp.net/blog/archive/january-2012/index.html">
        January 2012 (2)</a>,      <a href="http://tomasp.net/blog/archive/november-2011/index.html">
        November 2011 (5)</a>,      <a href="http://tomasp.net/blog/archive/august-2011/index.html">
        August 2011 (3)</a>,      <a href="http://tomasp.net/blog/archive/july-2011/index.html">
        July 2011 (2)</a>,      <a href="http://tomasp.net/blog/archive/june-2011/index.html">
        June 2011 (2)</a>,      <a href="http://tomasp.net/blog/archive/may-2011/index.html">
        May 2011 (2)</a>,      <a href="http://tomasp.net/blog/archive/march-2011/index.html">
        March 2011 (4)</a>,      <a href="http://tomasp.net/blog/archive/december-2010/index.html">
        December 2010 (1)</a>,      <a href="http://tomasp.net/blog/archive/november-2010/index.html">
        November 2010 (6)</a>,      <a href="http://tomasp.net/blog/archive/october-2010/index.html">
        October 2010 (6)</a>,      <a href="http://tomasp.net/blog/archive/september-2010/index.html">
        September 2010 (4)</a>,      <a href="http://tomasp.net/blog/archive/july-2010/index.html">
        July 2010 (3)</a>,      <a href="http://tomasp.net/blog/archive/june-2010/index.html">
        June 2010 (2)</a>,      <a href="http://tomasp.net/blog/archive/may-2010/index.html">
        May 2010 (1)</a>,      <a href="http://tomasp.net/blog/archive/february-2010/index.html">
        February 2010 (2)</a>,      <a href="http://tomasp.net/blog/archive/january-2010/index.html">
        January 2010 (3)</a>,      <a href="http://tomasp.net/blog/archive/december-2009/index.html">
        December 2009 (3)</a>,      <a href="http://tomasp.net/blog/archive/july-2009/index.html">
        July 2009 (1)</a>,      <a href="http://tomasp.net/blog/archive/june-2009/index.html">
        June 2009 (3)</a>,      <a href="http://tomasp.net/blog/archive/may-2009/index.html">
        May 2009 (2)</a>,      <a href="http://tomasp.net/blog/archive/april-2009/index.html">
        April 2009 (1)</a>,      <a href="http://tomasp.net/blog/archive/march-2009/index.html">
        March 2009 (2)</a>,      <a href="http://tomasp.net/blog/archive/february-2009/index.html">
        February 2009 (1)</a>,      <a href="http://tomasp.net/blog/archive/december-2008/index.html">
        December 2008 (1)</a>,      <a href="http://tomasp.net/blog/archive/november-2008/index.html">
        November 2008 (5)</a>,      <a href="http://tomasp.net/blog/archive/october-2008/index.html">
        October 2008 (1)</a>,      <a href="http://tomasp.net/blog/archive/september-2008/index.html">
        September 2008 (1)</a>,      <a href="http://tomasp.net/blog/archive/june-2008/index.html">
        June 2008 (1)</a>,      <a href="http://tomasp.net/blog/archive/march-2008/index.html">
        March 2008 (3)</a>,      <a href="http://tomasp.net/blog/archive/february-2008/index.html">
        February 2008 (1)</a>,      <a href="http://tomasp.net/blog/archive/december-2007/index.html">
        December 2007 (2)</a>,      <a href="http://tomasp.net/blog/archive/november-2007/index.html">
        November 2007 (6)</a>,      <a href="http://tomasp.net/blog/archive/october-2007/index.html">
        October 2007 (1)</a>,      <a href="http://tomasp.net/blog/archive/september-2007/index.html">
        September 2007 (1)</a>,      <a href="http://tomasp.net/blog/archive/august-2007/index.html">
        August 2007 (1)</a>,      <a href="http://tomasp.net/blog/archive/july-2007/index.html">
        July 2007 (2)</a>,      <a href="http://tomasp.net/blog/archive/april-2007/index.html">
        April 2007 (2)</a>,      <a href="http://tomasp.net/blog/archive/march-2007/index.html">
        March 2007 (3)</a>,      <a href="http://tomasp.net/blog/archive/february-2007/index.html">
        February 2007 (3)</a>,      <a href="http://tomasp.net/blog/archive/january-2007/index.html">
        January 2007 (2)</a>,      <a href="http://tomasp.net/blog/archive/november-2006/index.html">
        November 2006 (1)</a>,      <a href="http://tomasp.net/blog/archive/october-2006/index.html">
        October 2006 (3)</a>,      <a href="http://tomasp.net/blog/archive/august-2006/index.html">
        August 2006 (2)</a>,      <a href="http://tomasp.net/blog/archive/july-2006/index.html">
        July 2006 (1)</a>,      <a href="http://tomasp.net/blog/archive/june-2006/index.html">
        June 2006 (3)</a>,      <a href="http://tomasp.net/blog/archive/may-2006/index.html">
        May 2006 (2)</a>,      <a href="http://tomasp.net/blog/archive/april-2006/index.html">
        April 2006 (2)</a>,      <a href="http://tomasp.net/blog/archive/december-2005/index.html">
        December 2005 (1)</a>,      <a href="http://tomasp.net/blog/archive/july-2005/index.html">
        July 2005 (4)</a>,      <a href="http://tomasp.net/blog/archive/june-2005/index.html">
        June 2005 (5)</a>,      <a href="http://tomasp.net/blog/archive/may-2005/index.html">
        May 2005 (1)</a>,      <a href="http://tomasp.net/blog/archive/april-2005/index.html">
        April 2005 (3)</a>,      <a href="http://tomasp.net/blog/archive/march-2005/index.html">
        March 2005 (3)</a>,      <a href="http://tomasp.net/blog/archive/january-2005/index.html">
        January 2005 (1)</a>,      <a href="http://tomasp.net/blog/archive/december-2004/index.html">
        December 2004 (3)</a>,      <a href="http://tomasp.net/blog/archive/november-2004/index.html">
        November 2004 (2)</a>,    </div>
    <div class="large-2 columns">
      <h4>License</h4>
      <p>Unless explicitly mentioned, all articles on this site are licensed under <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution Share Alike</a>. 
        All source code samples are licensed under Apache 2.0.
      </p>
      <img src="http://tomasp.net/img/cc-sa.png" alt="CC License logo" />
    </div>
  </footer>
  </div>
  
  <script>
  document.write('<script src=' +
  ('__proto__' in {} ? 'http://tomasp.net/js/vendor/zepto' : 'http://tomasp.net/js/vendor/jquery') +
  '.js><\/script>')
  </script>
  
  <script src="http://tomasp.net/js/foundation.min.js"></script>
  <script>
    $(document).foundation();
  </script>
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-1561220-1']);
    _gaq.push(['_trackPageview']);

    (function () {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
  <script src="http://cdn.lanyrd.net/badges/person-v1.min.js"></script>
</body>
</html>