<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
  <meta charset="utf-8">
  <title>Práce s programem Windows Messenger</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Co vše lze dělat pomocí COM objektů programu Windows Messenger">
  <meta name="author" content="Tomas Petricek">

  <!-- Reference Foundation -->
  <link rel="stylesheet" href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/css/foundation.css">
  <script src="cjs/vendor/custom.modernizr.js"></script>

  <!-- Reference custom CSS and tooltips -->
  <link type="text/css" rel="stylesheet" href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/custom/style.css" />
  <script type="text/javascript" src="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/custom/tooltips.js"></script>
  <link type="text/css" rel="stylesheet" href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/custom/tooltips.css" />
</head>
<body>

   <header id="top-header">
    <div class="row">
      <div class="twelve columns">
        <h1><a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/">Tomas Petricek's blog</a></h1>
        <p>Writing about practical F# coding and programming language research</p>
      </div>
    </div>
  </header>

  <header class="top-bar-header">
    <div class="contain-to-grid sticky">
    <nav class="top-bar">

    <ul class="title-area">
      <li class="name"><h1><a href="#"></a></h1></li>
      <li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
    </ul>
    <section class="top-bar-section">
      <ul class="right">
        <li><a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/blog/index.html">Blog</a></li>
        <li><a href="http://functional-programming.net">Trainings</a></li>
        <li><a href="http://functional-programming.net">Books</a></li>
        <li><a href="http://lanyrd.com/profile/tomasp">Talks</a></li>
        <li><a href="http://www.cl.cam.ac.uk/~tp322">Research & Teaching</a></li>
      </ul>
    </section>

    </nav></div>
  </header>
  
  
<div class="row">
	<div class="large-8 columns main-content">
    <content>
      
<h1>Práce s programem Windows Messenger</h1>
<doc version="1"><body><h1>Práce s programem Windows Messenger</h1><p>Program Messenger dovoluje ostatním aplikacím prostřednictvím COM objektů 
			v omezené míře používat jeho funkčnost. Je k tomu potřeba nainstalovaný objekt,
			který je součástí Windows Messenger, ale kupodivu není v programu MSN
			Messenger - to znamená, že pokud nemáte nainstalovaný Windows Messenger
			(což se může stát pouze ve Windows 2003), tak nebudete moci s Messengerem 
			pracovat. To že je objekt součástí Windows Messenger, ale kupodivu neznamená,
			že při práci s objektem musíte být přihlášeni v tomto programu a tak lze objekt
			používat i pokud používáte MSN Messenger.</p><h4>Co jde a co nejde udělat?</h4><p>Pomocí objektů lze přistupovat téměř ke všem funkcím Messengera.
			Bohužel není možné dělat to nejdůležitější to jest posílat zprávy. Podle dokumentace
			tato funkce dříve existovala, ale v novějších verzích byla (pravděpodobně z 
			bezpečnostních důvodů) odstraněna. Pokud chcete tedy ze svého programu odesílat
			zprávy můžete pouze zavolat funkci, která otevře standardní komunikační
			okno Messengera. Bylo by sice možné po otevření okna pomocí API funkcí okno 
			najít, poslat mu příslušné zprávy a zase ho zavřít, ale to rozhodně není
			elegantní řešení.</p><h4>Ukázka práci s objekty</h4><!-- http://blog.vyvojar.cz/dnroot/tomas/msncontrol/contactlist.gif --><p><img src="msncontrol/contactlist.gif" alt="Ovládací prvek na výpis contact listu" /></p><p>Pokud jste někdy otevírali dokument ze SharePoint serveru tak víte, že
			například Word dokáže zjišťovat kdo s lidí, kteří pracovali s daným 
			dokumentem je online a umožňuje s nimi komunikovat. Vytvořit takový ovládací prvek 
			na výpis online uživatelů není příliš komplikované.</p><p>První co je potřeba udělat je přidat referenci na knihovny ve kterých je objekt
			(a Visual Studio v automaticky vygeneruje .Net wrappery). Stačí kliknout na
			"Přidat referenci" a vyhledat soubor <code>msmsgs.exe</code> (spouštěcí soubor
			messengera). Z přidaných referencí stačí jedna a to <code>MessengerAPI</code>.
			Dále je potřeba vytvořit objekt pro práci s messengerem (a ještě bude potřeba zkusit 
			uživatele přihlásit pokud je offline):</p><pre><span class="c">// Objekt pro praci s Messengerem</span>
IMessenger msnObj=msnObj=new MessengerClass();
  
<span class="c">// Pokud je uzivatel offline tak ho prihlasime</span>
if (msnObj.MyStatus==MISTATUS.MISTATUS_OFFLINE) 
  msnObj.AutoSignin();
</pre><p>Předcházející kód vytvoří objekt Messengera (pokud není Messenger nainstalovaný
		vyhodí vyjímku). Pokud není spuštěný ani MSN Messenger ani Windows Messenger,
		tak se při vytváření spustí druhý uvedený. Po přihlášení uživatele je možné 
		získat jeho online kontakty a to následujícím způsobem:</p><pre><span class="c">// Objekt pro praci s contact listem</span>
IMessengerContacts contacts=(IMessengerContacts)msnObj.MyContacts;
  
<span class="c">// Pridat kontakty do ListView</span>
foreach(IMessengerContact contact in contacts)
{
  <span class="c">// Do vlastnosti Tag si ulozime contact pro pozdejsi praci s nim</span>
  ListViewItem lvi=new ListViewItem();
  lvi.Tag=contact; 
  lvi.Text=contact.FriendlyName;
  listViewContacts.Items.Add(lvi);
}</pre><p>Tento kód sice nevytvoří tak hezký seznam kontaktů jako na výše uvedeném obrázku,
		ale na ukázku to jistě stačí. Získat další informace o uživateli v kontaktu lze 
		velmi snadno pomocí vlastností <code>IMessengerContact</code>. To že v cyklu 
		ukládáme do <code>Tag</code> (což je vlastnost kam si progamátor může uložit co 
		potřebuje) objekt kontaktu má svůj smysl, protože díky tomu bude velmi snadné napsat
		zpracování události <code>DoubleClick</code>, která se bude chovat jak by se od ní
		slušelo, tedy při poklepání na online kontakt zobrazí okno s konverzací a při
		poklepání na offline kontakt umožní odeslat email na jeho adresu.</p><pre><span class="c">// Pokud neni vybrana jedna polozka tak nic</span>
if (SelectedItems.Count!=1) return;
  
<span class="c">// Zjistit informace o kontaktu z Tag</span>
IMessengerContact contact=(IMessengerContact)SelectedItems[0].Tag;
<span class="c">// .. a poslat email/zpravu</span>
if (contact.Status==MISTATUS.MISTATUS_OFFLINE)
  msnObj.SendMail(contact);
else
  msnObj.InstantMessage(contact);
</pre><h4>Ovládací prvek na výpis kontaktů</h4><p>Celý ovládací prvek, tak jak je vyobrazen na obrázku nahoře dávám k dispozici
			včetně zdrojových kódu, takže pokud ho chcete použít a nebo se chcete podívat na
			celý zdrojový kód můžete si ho stáhnout [<a href="#links214">1</a>]. Proti zde popsané ukázce má ovládací
			prvek pár vylepšení. Je napsaná tak, aby kontakty přidávala do seznamu
			pouze jednou a poté pouze aktualizuje zobrazované informace a jako další
			vylepšení umožňuje kontakty zobrazovat setřízené.</p><p>Používání objektů programu Messenger je hodně omezené a zdaleka není možné
			dosáhnout všeho, co by bylo potřeba, ale pro jednoduché rozšíření vaší aplikace
			o možnost komunikace (například s lidmi, kteří se nějak podíleli na tvorbě
			dokumentu) to mylím stačí. Pokud potřebujete používat nějaký pokročilejší
			funkce pro komunikaci můžete se podívat na Microsoftí produkt Live 
			Communications Server [<a href="#links214">3</a>], který je k tomuto přímo určen.</p><h4>Odkazy na související stránky</h4><a name="links214"></a><ul class="externallinks"><li>[1] <a href="http://blog.vyvojar.cz/dnroot/tomas/msncontrol/msncontrol.zip">Ovládací prvek na zobrazení kontaktů</a>
    		[<a href="http://blog.vyvojar.cz/dnroot/tomas/msncontrol/msncontrol.zip" target="_blank">^</a>] (46,5kB)</li><li>[2] <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/WinMessenger/winmessenger/reference/messengeruasdk/cpp_client_entry.asp">Windows Messenger Client Reference</a>
    		[<a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/WinMessenger/winmessenger/reference/messengeruasdk/cpp_client_entry.asp" target="_blank">^</a>] - MSDN</li><li>[3] <a href="http://www.microsoft.com/office/livecomm/prodinfo/overview.mspx">Live Communications Server 2005</a>
    		[<a href="http://www.microsoft.com/office/livecomm/prodinfo/overview.mspx" target="_blank">^</a>] - Microsoft.com</li></ul></body></doc>

    </content>

  </div>
  <div class="large-4 columns" id="right-bar">
    <script type="text/javascript">
      var monthNames =
        [ "January", "February", "March", "April", "May", "June",
          "July", "August", "September", "October", "November", "December"];
      var d = new Date();
    </script>
    <div class="right-item" id="right-calendar">
      <h4>Calendar -  <script type="text/javascript">document.write(monthNames[d.getMonth()] + " " + d.getFullYear());</script></h4>
      <img src="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/calendar/current.jpg" />
      <p>The calendar shows a new picture each month since 
        <a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/calendar/2005">2005</a>, <a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/calendar/2006">2006</a>, 
        <a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/calendar/2007">2007</a>, <a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/calendar/2008">2008</a>, 
        <a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/calendar/2009">2009</a>, <a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/calendar/2010">2010</a>, 
        <a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/calendar/2011">2011</a>, <a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/calendar/2012">2012</a>. <br />
        See the first photos of <a href="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/calendar/2013">2013</a>.
      </p>
    </div>

    <h3>Welcome!</h3>
    <img src="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/img/tomas.jpg" alt="Tomas Petricek" style="float:right;margin:10px 0px 10px 10px;" />
    <p>I'm an F# enthusiast, book author and a PhD student at the University of Cambridge.
      When offline, I enjoy traveling and taking pictures. You can find me at
      at <a href="http://twitter.com/tomaspetricek">@tomaspetricek</a> or email 
      <a href="mailto:tomas@tomasp.net">tomas@tomasp.net</a>.
    </p>

    <h4>Trainings and consulting</h4>
    <img src="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/img/skillsmatter.png" alt="Tomas Petricek" style="float:right;margin:15px 0px 10px 10px;" />
    <p>I run F# and functional programming courses in <strong>London</strong>
      and <strong>New York</strong> with SkillsMatter.
    </p>
    <ul>
      <li>Check out our <a href="http://skillsmatter.com/course/scala/tomas-petricek-phil-trelford-fast-track-to-fsharp/ps-6679">Fast Track to F#</a> course</li>
      <li><a href="mailto:tomas@tomasp.net">Email me</a> for info about private trainings</li>
    </ul>
    
    <h4>F# Books and articles</h4>
    <div style="float:right;">
      <a href="http://www.amazon.com/gp/product/1933988924/ref=as_li_tf_il?ie=UTF8&amp;tag=httptomasnet-20&amp;linkCode=as2&amp;camp=217145&amp;creative=399369&amp;creativeASIN=1933988924">
        <img src="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/img/rwfp.jpg" alt="Real World Functional Programming" style="float:right;margin:10px 0px 10px 10px;border-style:none;" />
      </a>
    </div>
    <p><a href="http://www.manning.com/petricek">Real World Functional Programming</a> explains functional
      concepts using F# and C#. You can get it from <a href="http://www.amazon.com/dp/1933988924?tag=httptomasnet-20&amp;camp=213381&amp;creative=390973&amp;linkCode=as4&amp;creativeASIN=1933988924&amp;adid=0F1DP260JGG4KY0CDGP6">Amazon.com</a>, <a href="https://www.amazon.co.uk/dp/1933988924?tag=tomasnet-21&amp;camp=1406&amp;creative=6394&amp;linkCode=as1&amp;creativeASIN=1933988924&amp;adid=1CTY87YCCQEJW965GNDF">Amazon.co.uk</a> or your favorite book store.
      Some chapters and new materials are also available on <a href="http://msdn.microsoft.com/en-us/library/hh314518.aspx">MSDN</a>.</p>
    
    <p>Currently, I'm putting together <a href="http://www.manning.com/petricek2/">F# Deep Dives</a> - a collection
      of practical F# essays written by community leaders and commercial users of F#.</p>
    <p>I also wrote a series of tutorials on <a href="http://www.tryfsharp.org/Learn/financial-computing">financial computing</a>
      for Try F# - an interactive environment that let's you try F# in the browser.</p>

    <h4>Research and teaching</h4>
    <img src="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/img/cam.png" alt="University of Cambride" style="float:right;margin:25px 0px 10px 10px;" />
    <p>I'm finishing PhD in computer science at the <a href="http://www.cl.cam.ac.uk/">University of Cambridge</a>.
      I'm working on making better types for programs that run in rich context (like F# type providers, distributed 
      prog&shy;ramming or data-flow). See <a href="http://www.cl.cam.ac.uk/~tp322/">my academic page</a> for
      more.</p>

  </div>
</div>


  <footer>
    tomas
  </footer>

  <script>
  document.write('<script src=' +
  ('__proto__' in {} ? 'file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/js/vendor/zepto' : 'file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/js/vendor/jquery') +
  '.js><\/script>')
  </script>
  
  <script src="file:///C:/Tomas/Projects/WebSites/TomaspNet.New/output/js/foundation.min.js"></script>
  <script>
    $(document).foundation();
  </script>
</body>
</html>